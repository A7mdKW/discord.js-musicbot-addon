const ytdl=require('ytdl-core'),{YTSearcher}=require('ytsearcher'),ypi=require('youtube-playlist-info'),Discord=require('discord.js'),PACKAGE=require('./package.json');exports.start=(n,d)=>{var s=new class{constructor(t,u){this.commands=new Map,this.aliases=new Map,this.youtubeKey=u&&u.youtubeKey,this.botPrefix=u&&u.prefix||'!',this.embedColor=u&&u.embedColor||'GREEN',this.thumbnailType=u&&u.thumbnailType||'high',this.anyoneCanLeave=!!(u&&u.anyoneCanLeave||!1),this.global=u&&u.global||!1,this.maxQueueSize=parseInt(u&&u.maxQueueSize||100),this.defVolume=parseInt(u&&u.defVolume||50),this.anyoneCanSkip=!!(u&&u.anyoneCanSkip||!1),this.clearInvoker=!!(u&&u.clearInvoker||!1),this.helpCmd=u&&u.helpCmd||'musichelp',this.disableHelp=!!(u&&u.disableHelp||!1),this.helpHelp=u&&u.helpHelp||'Shows help for commands.',this.helpAlt=u&&u.helpAlt||[],this.playCmd=u&&u.playCmd||'play',this.disablePlay=!!(u&&u.disablePlay||!1),this.playHelp=u&&u.playHelp||'Queue a song/playlist by URL or search for a song.',this.playAlt=u&&u.playAlt||[],this.skipCmd=u&&u.skipCmd||'skip',this.disableSkip=!!(u&&u.disableSkip||!1),this.skipHelp=u&&u.skipHelp||'Skip a song or multi songs.',this.skipAlt=u&&u.skipAlt||[],this.queueCmd=u&&u.queueCmd||'queue',this.disableQueue=!!(u&&u.disableQueue||!1),this.queueHelp=u&&u.queueHelp||'Shows the current queue.',this.queueAlt=u&&u.queueAlt||[],this.pauseCmd=u&&u.pauseCmd||'pause',this.pauseHelp=u&&u.pauseHelp||'Pauses the queue.',this.disablePause=!!(u&&u.disablePause||!1),this.pauseAlt=u&&u.pauseAlt||[],this.resumeCmd=u&&u.resumeCmd||'resume',this.disableResume=!!(u&&u.disableResume||!1),this.resumeHelp=u&&u.resumeHelp||'Resume the queue.',this.resumeAlt=u&&u.resumeAlt||[],this.volumeCmd=u&&u.volumeCmd||'volume',this.disableVolume=!!(u&&u.disableVolume||!1),this.volumeHelp=u&&u.volumeHelp||'Adjusts the volume of the bot.',this.volumeAlt=u&&u.volumeAlt||[],this.leaveCmd=u&&u.leaveCmd||'leave',this.disableLeave=!!(u&&u.disableLeave||!1),this.leaveHelp=u&&u.leaveHelp||'Leave and clear the queue.',this.leaveAlt=u&&u.leaveAlt||[],this.clearCmd=u&&u.clearCmd||'clearqueue',this.disableClear=!!(u&&u.disableClear||!1),this.clearHelp=u&&u.clearHelp||'Clears the current queue.',this.clearAlt=u&&u.clearAlt||[],this.searchCmd=u&&u.searchCmd||'search',this.disableSearch=!!(u&&u.disableSearch||!1),this.searchHelp=u&&u.searchHelp||'Searchs for up to 10 results.',this.searchAlt=u&&u.searchAlt||[],this.loopCmd=u&&u.loopCmd||'loop',this.disableLoop=!!(u&&u.disableLoop||!1),this.loopHelp=u&&u.loopHelp||'Changes the loop state.',this.loopAlt=u&&u.loopAlt||[],this.setCmd=u&&u.setCmd||'set',this.disableSet=!!(u&&u.disableSet||!1),this.setHelp=u&&u.setHelp||'Changes settings for the server. Use without specifing a setting to see valid settings.',this.setAlt=u&&u.setAlt||[],this.ownerCmd=u&&u.ownerCmd||'owner',this.disableOwnerCmd=!!(u&&u.disableOwnerCmd||!1),this.ownerHelp=u&&u.ownerHelp||'Owner commands and functions.',this.ownerAlt=u&&u.ownerAlt||[],this.npCmd=u&&u.npCmd||'np',this.disableNp=!!(u&&u.disableNp||!1),this.npHelp=u&&u.npHelp||'Shows the currently playing song.',this.npAlt=u&&u.npAlt||[],this.enableQueueStat=!!(u&&u.enableQueueStat||!1),this.anyoneCanAdjust=!!(u&&u.anyoneCanAdjust||!1),this.ownerOverMember=!!(u&&u.ownerOverMember||!1),this.botOwner=u&&u.botOwner||null,this.logging=!!(u&&u.logging||!1),this.enableAliveMessage=!!(u&&u.enableAliveMessage||!1),this.aliveMessage=u&&u.aliveMessage||'',this.aliveMessageTime=parseInt(u&&u.aliveMessageTime||6e5),this.requesterName=!!(u&&u.requesterName||!1),this.inlineEmbeds=!!(u&&u.inlineEmbeds||!1),this.maxWait=parseInt(u&&u.maxWait||15000),this.anyoneCanPause=!!(u&&u.anyoneCanPause||!0),this.dateLocal=u&&u.dateLocal||'en-US',this.clearOnLeave=u&&u.clearOnLeave||!1,this.checkQueues=u&&u.checkQueues||!1,this.queues=new Map,this.botPrefixs=new Map,this.advancedMode=u&&u.advancedMode||{},this.botAdmins=u&&u.botAdmins||[]}logger(t,u,o){console.log(`[${t}] [${u.guild.name}] ${o}`)}}(n,d);exports.bot=s,s.advancedMode&&s.advancedMode.enabled&&(s.advancedMode={enabled:!!(d&&d.advancedMode.enabled||!1),multiPrefix:!!(d&&d.advancedMode.multiPrefix||!1),serverPrefixs:d&&d.advancedMode.serverPrefixs||{}});(async function(){8>process.version.slice(1).split('.')[0]&&(console.log(new Error(`[MusicBot] node 8 or higher is needed, please update`)),process.exit(1)),s.disableLeave&&s.disableSkip&&s.disablePlay&&s.disableQueue&&s.disableHelp&&s.disableResume&&s.disablePause&&s.disableLoop&&s.disableClear&&s.disableNp&&s.disableSearch&&s.disableVolume&&(console.log(new Error(`all commands disabled`)),process.exit(1)),'object'!=typeof s.embedColor&&'number'!=typeof s.embedColor&&'string'!=typeof s.embedColor&&(console.log(new TypeError(`embedColor must be an object (array), number, or a string`)),process.exit(1)),'object'!=typeof s.botAdmins&&(console.log(new TypeError(`botAdmins must be an object (array)`)),process.exit(1)),'boolean'!=typeof s.clearOnLeave&&(console.log(new TypeError(`clearOnLeave must be a boolean`)),process.exit(1)),'boolean'!=typeof s.checkQueues&&(console.log(new TypeError(`checkQueues must be a boolean`)),process.exit(1)),'string'!=typeof s.dateLocal&&(console.log(new TypeError(`dateLocal must be a string`)),process.exit(1)),'object'!=typeof s.advancedMode&&(console.log(new TypeError(`advancedMode must be an object`)),process.exit(1)),s.advancedMode.enabled&&'boolean'!=typeof s.advancedMode.enabled&&(console.log(new TypeError(`advancedMode.enabled must be a boolean`)),process.exit(1)),s.advancedMode.multiPrefix&&'boolean'!=typeof s.advancedMode.multiPrefix&&(console.log(new TypeError(`advancedMode.multiPrefix must be a boolean`)),process.exit(1)),s.advancedMode.serverPrefixs&&'object'!=typeof s.advancedMode.serverPrefixs&&(console.log(new TypeError(`advancedMode.serverPrefixs must be an object`)),process.exit(1)),'string'!=typeof s.thumbnailType&&(console.log(new TypeError(`thumbnailType must be a string`)),process.exit(1));s.thumbnailType.match(/default|medium|high/)||(console.log(new Error(`thumbnailType must be one of the following: default, medium, high`)),process.exit(1));'string'!=typeof s.helpHelp&&(console.log(new TypeError(`helpHelp must be a string`)),process.exit(1));'object'!=typeof s.helpAlt&&(console.log(new TypeError(`helpAlt must be an array`)),process.exit(1));'string'!=typeof s.playHelp&&(console.log(new TypeError(`playHelp must be a string`)),process.exit(1));'object'!=typeof s.playAlt&&(console.log(new TypeError(`playAlt must be an array`)),process.exit(1));'string'!=typeof s.queueHelp&&(console.log(new TypeError(`queueHelp must be a string`)),process.exit(1));'object'!=typeof s.queueAlt&&(console.log(new TypeError(`queueAlt must be an array`)),process.exit(1));'string'!=typeof s.pauseHelp&&(console.log(new TypeError(`pauseHelp must be a string`)),process.exit(1));'object'!=typeof s.pauseAlt&&(console.log(new TypeError(`pauseAlt must be an array`)),process.exit(1));'string'!=typeof s.resumeHelp&&(console.log(new TypeError(`resumeHelp must be a string`)),process.exit(1));'object'!=typeof s.resumeAlt&&(console.log(new TypeError(`resumeAlt must be an array`)),process.exit(1));'string'!=typeof s.volumeHelp&&(console.log(new TypeError(`volumeHelp must be a string`)),process.exit(1));'object'!=typeof s.volumeAlt&&(console.log(new TypeError(`volumeAlt must be an array`)),process.exit(1));'string'!=typeof s.leaveHelp&&(console.log(new TypeError(`leaveHelp must be a string`)),process.exit(1));'object'!=typeof s.leaveAlt&&(console.log(new TypeError(`leaveAlt must be an array`)),process.exit(1));'string'!=typeof s.clearHelp&&(console.log(new TypeError(`clearHelp must be a string`)),process.exit(1));'object'!=typeof s.clearAlt&&(console.log(new TypeError(`clearAlt must be an array`)),process.exit(1));'string'!=typeof s.loopHelp&&(console.log(new TypeError(`loopHelp must be a string`)),process.exit(1));'object'!=typeof s.loopAlt&&(console.log(new TypeError(`loopAlt must be an array`)),process.exit(1));'string'!=typeof s.npHelp&&(console.log(new TypeError(`npHelp must be a string`)),process.exit(1));'object'!=typeof s.npAlt&&(console.log(new TypeError(`npAlt must be an array`)),process.exit(1));'string'!=typeof s.ownerHelp&&(console.log(new TypeError(`ownerHelp must be a string`)),process.exit(1));'object'!=typeof s.ownerAlt&&(console.log(new TypeError(`ownerAlt must be an array`)),process.exit(1));'string'!=typeof s.skipHelp&&(console.log(new TypeError(`skipHelp must be a string`)),process.exit(1));'object'!=typeof s.skipAlt&&(console.log(new TypeError(`skipAlt must be an array`)),process.exit(1));s.youtubeKey||(console.log(new Error(`youtubeKey is required but missing`)),process.exit(1));s.youtubeKey&&'string'!=typeof s.youtubeKey&&(console.log(new TypeError(`youtubeKey must be a string`)),process.exit(1));'boolean'!=typeof s.disableHelp&&(console.log(new TypeError(`disableHelp must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disablePlay&&(console.log(new TypeError(`disablePlay must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableSkip&&(console.log(new TypeError(`disableSkip must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableQueue&&(console.log(new TypeError(`disableQueue must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disablePause&&(console.log(new TypeError(`disablePause must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableResume&&(console.log(new TypeError(`disableResume must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableLeave&&(console.log(new TypeError(`disableLeave must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableClear&&(console.log(new TypeError(`disableClear must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableLoop&&(console.log(new TypeError(`disableLoop must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableNp&&(console.log(new TypeError(`disableNp must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableOwnerCmd&&(console.log(new TypeError(`disableOwnerCmd must be a boolean`)),process.exit(1)),'string'!=typeof s.ownerCmd&&(console.log(new TypeError(`ownerCmd must be a string`)),process.exit(1)),'boolean'!=typeof s.ownerOverMember&&(console.log(new TypeError(`ownerOverMember must be a boolean`)),process.exit(1));s.ownerOverMember&&'string'!=typeof s.botOwner&&(console.log(new TypeError(`botOwner must be a string`)),process.exit(1));'string'!=typeof s.botPrefix&&(console.log(new TypeError(`prefix must be a string`)),process.exit(1));(1>s.botPrefix.length||10<s.botPrefix.length)&&(console.log(new RangeError(`prefix length must be between 1 and 10`)),process.exit(1));'boolean'!=typeof s.global&&(console.log(new TypeError(`global must be a boolean`)),process.exit(1));'number'!=typeof s.maxQueueSize&&(console.log(new TypeError(`maxQueueSize must be a number`)),process.exit(1));Number.isInteger(s.maxQueueSize)||(console.log(new TypeError(`maxQueueSize must be an integer`)),process.exit(1));'number'!=typeof s.defVolume&&(console.log(new TypeError(`defaultVolume must be a number`)),process.exit(1));(!Number.isInteger(s.defVolume)||1>s.defVolume||200<s.defVolume)&&(console.log(new TypeError(`defaultVolume must be an integer between 1 and 200`)),process.exit(1));'boolean'!=typeof s.anyoneCanSkip&&(console.log(new TypeError(`anyoneCanSkip must be a boolean`)),process.exit(1));'boolean'!=typeof s.clearInvoker&&(console.log(new TypeError(`clearInvoker must be a boolean`)),process.exit(1));'boolean'!=typeof s.enableAliveMessage&&(console.log(new TypeError(`enableAliveMessage must be a boolean`)),process.exit(1));'string'!=typeof s.aliveMessage&&(console.log(new TypeError(`aliveMessage must be a string`)),process.exit(1));'number'!=typeof s.aliveMessageTime&&(console.log(new TypeError(`aliveMessageTime must be a number`)),process.exit(1));'string'!=typeof s.helpCmd&&(console.log(new TypeError(`helpCmd must be a string`)),process.exit(1));'string'!=typeof s.playCmd&&(console.log(new TypeError(`playCmd must be a string`)),process.exit(1));'string'!=typeof s.searchCmd&&(console.log(new TypeError(`searchCmd must be a string`)),process.exit(1));'boolean'!=typeof s.disableSearch&&(console.log(new TypeError(`disableSearch must be a boolean`)),process.exit(1));'string'!=typeof s.skipCmd&&(console.log(new TypeError(`skipCmd must be a string`)),process.exit(1));'string'!=typeof s.queueCmd&&(console.log(new TypeError(`queueCmd must be a string`)),process.exit(1));'string'!=typeof s.pauseCmd&&(console.log(new TypeError(`pauseCmd must be a string`)),process.exit(1));'string'!=typeof s.npCmd&&(console.log(new TypeError(`npCmd must be a string`)),process.exit(1));'string'!=typeof s.resumeCmd&&(console.log(new TypeError(`resumeCmd must be a string`)),process.exit(1));'string'!=typeof s.volumeCmd&&(console.log(new TypeError(`volumeCmd must be a string`)),process.exit(1));'string'!=typeof s.leaveCmd&&(console.log(new TypeError(`leaveCmd must be a string`)),process.exit(1));'string'!=typeof s.clearCmd&&(console.log(new TypeError(`clearCmd must be a string`)),process.exit(1));'string'!=typeof s.loopCmd&&(console.log(new TypeError(`loopCmd must be a string`)),process.exit(1));'boolean'!=typeof s.enableQueueStat&&(console.log(new TypeError(`enableQueueStat must be a boolean`)),process.exit(1));'boolean'!=typeof s.anyoneCanAdjust&&(console.log(new TypeError(`anyoneCanAdjust must be a boolean`)),process.exit(1));'boolean'!=typeof s.logging&&(console.log(new TypeError(`logging must be a boolean`)),process.exit(1));'boolean'!=typeof s.requesterName&&(console.log(new TypeError(`requesterName must be a boolean`)),process.exit(1));'boolean'!=typeof s.inlineEmbeds&&(console.log(new TypeError(`inlineEmbeds must be a boolean`)),process.exit(1));s.global&&50>s.maxQueueSize&&console.warn(`global queues are enabled while maxQueueSize is below 50! Recommended to use a higher size.`);try{if(!s.commands.has(s.helpCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.helpCmd} command.`);const t={name:s.helpCmd,usage:`${s.botPrefix}${s.helpCmd} [command]`,disabled:s.disableHelp,help:s.helpHelp,aliases:s.helpAlt,admin:!1,run:'musichelp'};s.commands.set(s.helpCmd,t),0<s.helpAlt.length&&s.helpAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.searchCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.searchCmd} command.`);const t={name:s.searchCmd,usage:`${s.botPrefix}${s.searchCmd} <query>`,disabled:s.disableSearch,help:s.searchHelp,aliases:s.searchAlt,admin:!1,run:'search'};s.commands.set(s.searchCmd,t),0<s.searchAlt.length&&s.searchAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.playCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.playCmd} command.`);const t={name:s.playCmd,usage:`${s.botPrefix}${s.playCmd} <song to queue>`,disabled:s.disablePlay,help:s.playHelp,aliases:s.playAlt,admin:!1,run:'play'};s.commands.set(s.playCmd,t),0<s.playAlt.length&&s.playAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.skipCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.skipCmd} command.`);const t={name:s.skipCmd,usage:`${s.botPrefix}${s.skipCmd} [numberOfSongs]`,disabled:s.disableSkip,help:s.skipHelp,aliases:s.skipAlt,admin:!0,run:'skip'};s.commands.set(s.skipCmd,t),0<s.skipAlt.length&&s.skipAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.queueCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.queueCmd} command.`);const t={name:s.queueCmd,usage:`${s.botPrefix}${s.queueCmd} [songNumber]`,disabled:s.disableQueue,help:s.queueHelp,aliases:s.queueAlt,admin:!1,run:'queue'};s.commands.set(s.queueCmd,t),0<s.queueAlt.length&&s.queueAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.pauseCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.pauseCmd} command.`);const t={name:s.pauseCmd,usage:null,disabled:s.disablePause,help:s.pauseHelp,aliases:s.pauseAlt,admin:!1,run:'pause'};s.commands.set(s.pauseCmd,t),0<s.pauseAlt.length&&s.pauseAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.resumeCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.resumeCmd} command.`);const t={name:s.resumeCmd,usage:null,disabled:s.disableResume,help:s.resumeHelp,aliases:s.resumeAlt,admin:!1,run:'resume'};s.commands.set(s.resumeCmd,t),0<s.resumeAlt.length&&s.resumeAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.volumeCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.volumeCmd} command.`);const t={name:s.volumeCmd,usage:`${s.botPrefix}${s.volumeCmd} <1 - 200>`,disabled:s.disableVolume,help:s.volumeHelp,aliases:s.volumeAlt,admin:!1,run:'volume'};s.commands.set(s.volumeCmd,t),0<s.volumeAlt.length&&s.volumeAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.clearCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.clearCmd} command.`);const t={name:s.clearCmd,usage:null,disabled:s.disableClear,help:s.clearHelp,aliases:s.clearAlt,admin:!1,run:'clearqueue'};s.commands.set(s.clearCmd,t),0<s.clearAlt.length&&s.clearAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.npCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.npCmd} command.`);const t={name:s.npCmd,usage:null,disabled:s.disableNp,help:s.npHelp,aliases:s.npAlt,admin:!1,run:'np'};s.commands.set(s.npCmd,t),0<s.npAlt.length&&s.npAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.leaveCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.leaveCmd} command.`);const t={name:s.leaveCmd,usage:null,disabled:s.disableLeave,help:s.leaveHelp,aliases:s.leaveAlt,admin:!1,run:'leave'};s.commands.set(s.leaveCmd,t),0<s.leaveAlt.length&&s.leaveAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.loopCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.loopCmd} command.`);const t={name:s.loopCmd,usage:null,disabled:s.disableLoop,help:s.loopHelp,aliases:s.loopAlt,admin:!1,run:'loop'};s.commands.set(s.loopCmd,t),0<s.loopAlt.length&&s.loopAlt.forEach(u=>{s.aliases.set(u,t)})}if(!s.commands.has(s.setCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.setCmd} command.`);const t={name:s.setCmd,usage:`${s.botPrefix}${s.setCmd} <setting>`,disabled:s.disableSet,help:s.setHelp,aliases:s.setAlt,admin:!1,run:'set'};s.commands.set(s.setCmd,t),0<s.setAlt.length&&s.setAlt.forEach(u=>{s.aliases.set(u,t)})}}catch(t){console.error(t.stack),process.exit(1)}})(),s.searcher=new YTSearcher({key:s.youtubeKey,revealkey:!0}),exports.changeKey=t=>{return new Promise((u,o)=>{t&&'string'==typeof t||o('invalid key provided'),s.youtubeKey=t,s.searcher=new YTSearcher({key:t,revealkey:!0}),u(s)})},n.on('message',t=>{const u=t.content.trim();if(s.advancedMode.enabled&&s.advancedMode.multiPrefix){if(s.botPrefixs.has(t.guild.id)){const o=s.botPrefixs.get(t.guild.id).prefix;if(!u.startsWith(o))return;const r=u.substring(o.toString().length).split(/[ \n]/)[0].trim(),c=u.substring(o.toString().length+r.length).trim(),g=u.slice(o.toString().length+r.length).trim().split(/ +/g);if(s.commands.has(r)){let f=s.commands.get(r);if(!f.disabled)return s[f.run](t,c,g)}else if(s.aliases.has(r)){let f=s.aliases.get(r);if(!f.disabled)return s[f.run](t,c,g)}}else if(u.startsWith(s.botPrefix)){const o=u.substring(s.botPrefix.length).split(/[ \n]/)[0].trim(),r=u.substring(s.botPrefix.length+o.length).trim(),c=u.slice(s.botPrefix.length+o.length).trim().split(/ +/g);if(s.commands.has(o)){let g=s.commands.get(o);if(!g.disabled)return s[g.run](t,r,c)}else if(s.aliases.has(o)){let g=s.aliases.get(o);if(!g.disabled)return s[g.run](t,r,c)}}}else if(u.startsWith(s.botPrefix)){const o=u.substring(s.botPrefix.length).split(/[ \n]/)[0].trim(),r=u.substring(s.botPrefix.length+o.length).trim(),c=u.slice(s.botPrefix.length+o.length).trim().split(/ +/g);if(s.commands.has(o)){let g=s.commands.get(o);if(!g.disabled)return s[g.run](t,r,c)}else if(s.aliases.has(o)){let g=s.aliases.get(o);if(!g.disabled)return s[g.run](t,r,c)}}}),n.on('ready',()=>{s.advancedMode&&!0===s.advancedMode.enabled&&s.advancedMode&&!0===s.advancedMode.multiPrefix&&'object'==typeof s.advancedMode.serverPrefixs&&n.guilds.forEach(t=>{if(s.advancedMode.serverPrefixs.has(t.id)){var u=s.advancedMode.serverPrefixs.get(t.id);let o={id:t.id,prefix:u.prefix};s.botPrefixs.set(t.id,o)}else{let o={id:t.id,prefix:s.botPrefix};s.botPrefixs.set(t.id,o)}});s.enableAliveMessage&&setInterval(function(){s.aliveMessage=3>s.aliveMessage.length?`----------------------------------\n${n.user.username} online since ${n.readyAt}!\n----------------------------------`:s.aliveMessage.replace(/{{username}}/g,`${n.user.username}`).replace(/{{starttime}}/g,`${n.readyAt}`),console.log(s.aliveMessage)},s.aliveMessageTime);console.log(`------- ${n.user.username} -------\n> Version: ${PACKAGE.version}\n> Extra Logging: ${s.logging}.\n> Using Global Queue: ${s.global}.\n> Node.js Version: ${process.version}\n------- ${n.user.username} -------`),s.enableQueueStat||console.log(`[MUSIC] enableQueueStat is 'false'. Queue will not have a Playing/Paused indicator.`),!0==s.checkQueues&&(console.warn(`[MUSIC] checkQueues is enabled.`),s.verify=t=>{return new Promise((u,o)=>{t?t&&null==t.songs?o(1):t&&t.songs.length>s.maxQueueSize&&0!==s.maxQueueSize?o(1):t&&0>t.songs.length?o(1):t&&'string'!=typeof t.loop?o(2):t&&!t.id&&o(3):o(0),t.songs.forEach(r=>{r.title&&r.url&&r.queuedOn&&r.requester||o(4)}),u('pass')})},exports.verifyQueue=s.verify,setInterval(()=>{s.queues.forEach(t=>{s.verify(t).then(()=>{s.logging&&console.log(`[Check Queues Music] Queue ${t.id} passed verification.`)}).catch(u=>{if(0<=u){let o={songs:[],last:null,loop:'none',id:`${t.toString()}`};s.queues.set(t.id,o)}try{const o=n.voiceConnections.find(r=>`${t.toString()}`==r.channel.guild.id);null!==o&&(o.player.dispatcher.end(),o.disconnect())}catch(o){console.error(o)}})})},3.6e6))}),s.updatePrefix=(t,u)=>{if(s&&s.advancedMode.enabled&&s.advancedMode.multiPrefix)return new Promise((o,r)=>{'string'!=typeof t&&r(`server was not a string`),'string'!=typeof u&&r(`prefix was not a string`);let c;if(s.botPrefixs.has(t))c=s.botPrefixs.get(t),c.prefix=u,s.botPrefixs.set(t,c),o(`Prefix updated to \`${u}\`!`);else{s.botPrefixs.set(t,{id:t,prefix:u}),o(`Prefix updated to \`${u}\`!`)}})},s.isAdmin=t=>{return s.ownerOverMember&&t.id===s.botOwner||!!s.botAdmins.includes(t.id)||t.hasPermission('ADMINISTRATOR')},s.canSkip=(t,u)=>{return!!s.anyoneCanSkip||!!s.botAdmins.includes(t.id)||s.ownerOverMember&&t.id===s.botOwner||u[0].requester===t.id||!!s.isAdmin(t)},s.canAdjust=(t,u)=>{return!!s.anyoneCanAdjust||!!s.botAdmins.includes(t.id)||s.ownerOverMember&&t.id===s.botOwner||u[0].requester===t.id||!!s.isAdmin(t)},s.dInvoker=t=>{if(s.clearInvoker){if(!t)return;t.delete()}},s.getQueue=(t,u)=>{if(s.global&&(t='_'),!s.queues.has(t)){let o={songs:[],last:null,loop:'none',id:t};s.queues.set(t,o)}return!0==u?s.queues.get(t).songs:u&&!1!=u?void 0:s.queues.get(t)},s.setLast=(t,u)=>{return new Promise((o,r)=>{let c;s.queues.has(t)?(c=s.queues.get(t),c.last=u,s.queues.set(t,c),o(s.queues.get(t))):r('no server queue')})},s.getLast=t=>{return new Promise(u=>{let r=s.queues.has(t)?s.queues.get(t).last:null;r&&r.last?r.last&&u(r.last):u(null)})},s.isQueueEmpty=t=>{return new Promise((u,o)=>{t||o('no queue passed');'object'==typeof t?0<t.length?u(!1):0>=t.length&&u(!0):t&&t.songs?0<t.songs.length?u(!1):0>=t.songs.length&&u(!0):o('no queue/songs found')})},exports.isQueueEmpty=s.isQueueEmpty,s.emptyQueue=t=>{return new Promise((u,o)=>{let r=s.queues.has(t)?s.queues.get(t):null;r||o(new Error(`[emptyQueue] no queue found for ${t}`));s.queues.set(t,{songs:[],last:null,loop:'none',id:t}),u(s.queues.get(t))})},s.musichelp=(t,u)=>{s.dInvoker(t);let o=u.trim();if(!u){if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const f=new Discord.RichEmbed;f.setAuthor('Commands',t.author.displayAvatarURL),f.setDescription(`Use \`${s.botPrefix}${s.helpCmd} command name\` for help on usage.`);const h=Array.from(s.commands);for(var r=0;r<h.length;r++){let p=h[r][1];p.disabled||f.addField(p.name,p.help)}f.setColor(s.embedColor),setTimeout(()=>{if(s.messageHelp){let p=!1;t.author.send({embed:f}).then(()=>{p=!0}),setTimeout(()=>{if(!p)return t.channel.send({embed:f})},1200)}else return t.channel.send({embed:f})},1500)}else{var c=`= Music Commands =\nUse ${s.botPrefix}${s.helpCmd} [command] for help on a command.\n`;const f=Array.from(s.commands);for(var r=0;r<f.length;r++){let h=f[r][1];h.disabled||(c+=`\n• ${h.name}: ${h.help}`)}setTimeout(()=>{if(s.messageHelp){let h=!1;t.author.send(c,{code:'asciidoc'}).then(()=>{h=!0}),setTimeout(()=>{if(!h)return t.channel.send(c,{code:'asciidoc'})},500)}else return t.channel.send(c,{code:'asciidoc'})},1500)}}else if(!(s.commands.has(o)||s.aliases.has(o)))t.channel.send(s.note('fail',`${u} is not a valid command!`));else if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const f=new Discord.RichEmbed;o=s.commands.get(o)||s.aliases.get(o),f.setAuthor(o.name,t.client.user.avatarURL),f.setDescription(o.help),0<o.aliases.length&&f.addField(`Aliases`,o.aliases.join(', '),s.inlineEmbeds),null!==o.usage&&f.addField(`Usage`,o.usage,s.inlineEmbeds),f.setColor(s.embedColor),t.channel.send({embed:f})}else{o=s.commands.get(o)||s.aliases.get(o);var g=`= ${o.name} =\n`;g+`\n${o.help}`,null!==o.usage&&(g+=`\nUsage: ${o.usage}\n`),0<o.aliases.length&&(g+=`\nAliases: ${o.aliases.join(', ')}`),t.channel.send(g,{code:'asciidoc'})}},s.play=(t,u)=>{if(s.dInvoker(t),void 0===t.member.voiceChannel)return t.channel.send(s.note('fail',`You're not in a voice channel.`));if(!u)return t.channel.send(s.note('fail','No video specified!'));const o=s.getQueue(t.guild.id);if(o.songs.length>=s.maxQueueSize&&0!==s.maxQueueSize)return t.channel.send(s.note('fail','Maximum queue size reached!'));var r=u.trim();t.channel.send(s.note('search',`Searching: \`${r}\``)).then(c=>{if(r.startsWith('http')&&r.includes('list=')){var g=r.toString().split('list=')[1];g.toString().includes('?')&&(g=g.split('?')[0]),g.toString().includes('&t=')&&(g=g.split('&t=')[0]),ypi.playlistInfo(s.youtubeKey,g,function(f){const h=Array.from(f);var p=0,b=0;h.forEach(v=>{(b++,o.songs.length!=s.maxQueueSize+1||0===s.maxQueueSize)&&('youtube#video'==v.resourceId.kind&&(!v.url&&(v.url=`https://www.youtube.com/watch?v=`+v.resourceId.videoId),v.requester=t.author.id,v.queuedOn=new Date().toLocaleDateString(s.dateLocal,{weekday:'long',hour:'numeric'}),s.requesterName&&(v.requesterAvatarURL=t.author.displayAvatarURL),o.songs.push(v),1===o.songs.length&&s.executeQueue(t,o),p++),b==h.length&&((p=0)?t.channel.send(s.note('fail',`Coudln't get any songs from that playlist.`)):1==p?t.channel.send(s.note('note',`Queued one song.`)):1<p&&t.channel.send(s.note('note',`Queued ${p} songs.`))))})})}else s.searcher.search(r,{type:'video'}).then(f=>{if(!f.totalResults||0===f.totalResults)return c.edit(s.note('fail','Failed to get search results.'));var h=f.first;if(h.requester=t.author.id,h.channelURL=`https://www.youtube.com/channel/${h.channelId}`,h.queuedOn=new Date().toLocaleDateString(s.dateLocal,{weekday:'long',hour:'numeric'}),s.requesterName&&(h.requesterAvatarURL=t.author.displayAvatarURL),o.songs.push(h),1<o.songs.length)if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const b=new Discord.RichEmbed;try{b.setAuthor('Adding To Queue',n.user.avatarURL);var p=h.title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');b.setColor(s.embedColor),b.addField(h.channelTitle,`[${p}](${h.url})`,s.inlineEmbeds),b.addField('Queued On',h.queuedOn,s.inlineEmbeds),b.setThumbnail(h.thumbnails.high.url);const v=n.users.get(h.requester);s.requesterName&&v&&b.setFooter(`Requested by ${n.users.get(h.requester).username}`,h.requesterAvatarURL),s.requesterName&&!v&&b.setFooter(`Requested by \`UnknownUser (ID: ${h.requester})\``,h.requesterAvatarURL),t.channel.send({embed:b})}catch(v){console.error(`[${t.guild.name}] [npCmd] `+v.stack)}}else try{var p=h.title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');t.channel.send(`Now Playing: **${p}**\nRequested By: ${n.users.get(h.requester).username}\nQueued On: ${h.queuedOn}`)}catch(b){console.error(`[${t.guild.name}] [npCmd] `+b.stack)}1!==o.songs.length&&n.voiceConnections.find(b=>b.channel.guild.id==t.guild.id)||s.executeQueue(t,o)})}).catch(console.log)},s.search=(t,u)=>{if(s.dInvoker(t),void 0===t.member.voiceChannel)return t.channel.send(s.note('fail',`You're not in a voice channel~`));if(!u)return t.channel.send(s.note('fail','No video specified!'));const o=s.getQueue(t.guild.id);if(o.songs.length>=s.maxQueueSize&&0!==s.maxQueueSize)return t.channel.send(s.note('fail','Maximum queue size reached!'));var r=u.trim();t.channel.send(s.note('search',`Searching: \`${r}\``)).then(c=>{s.searcher.search(r,{type:'video'}).then(g=>{if(!g.totalResults||0===g.totalResults)return c.edit(s.note('fail','Failed to get search results.'));const f=async(C,x)=>{const y=new Discord.RichEmbed;y.setTitle(`Choose Your Video`),y.setColor(s.embedColor);var A=0;C.forEach(function(k){A++,y.addField(`${A} (${k.channelTitle})`,`[${s.note('font',k.title)}](${k.url})`,s.inlineEmbeds)}),y.setFooter(`Search by: ${t.author.username}`,t.author.displayAvatarURL),t.channel.send({embed:y}).then(k=>{var S=null;0===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||`cancel`===P.content.trim():1===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||`cancel`===P.content.trim():2===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||`cancel`===P.content.trim():3===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||`cancel`===P.content.trim():4===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||`cancel`===P.content.trim():5===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||`cancel`===P.content.trim():6===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||`cancel`===P.content.trim():7===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||P.content.includes('8')||`cancel`===P.content.trim():8===x?S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||P.content.includes('8')||P.content.includes('9')||`cancel`===P.content.trim():9==x&&(S=P=>P.author.id===t.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||P.content.includes('8')||P.content.includes('9')||P.content.includes('10')||`cancel`===P.content.trim()),t.channel.awaitMessages(S,{max:1,time:6e4,errors:['time']}).then(P=>{const Q=Array.from(P),L=Q[0][1].content;if('cancel'===L)return k.edit(s.note('note','Searching canceled.'));const E=parseInt(L)-1;if(0<=E)return k.delete(),t.channel.send(s.note('note',`Queued **${s.note('font',C[E].title)}**`)).then(()=>{o.songs.push(C[E]),1!==o.songs.length&&n.voiceConnections.find(H=>H.channel.guild.id==t.guild.id)||s.executeQueue(t,o)}).catch(console.log)}).catch(P=>{return P.toString().match(/error|Error|TypeError|RangeError|Uncaught/)?k.edit(`\`\`\`xl\nSearching canceled. ${P}\n\`\`\``):k.edit(`\`\`\`xl\nSearching canceled.\n\`\`\``)})})},h=10<=g.totalResults?9:g.totalResults-1;for(var v,p=[],b=0;99>b;b++)v=g.currentPage[b],v.requester=t.author.id,s.requesterName&&(v.requesterAvatarURL=t.author.displayAvatarURL),v.channelURL=`https://www.youtube.com/channel/${v.channelId}`,v.queuedOn=new Date().toLocaleDateString(s.dateLocal,{weekday:'long',hour:'numeric'}),p.push(v),b===h&&(b=101,f(p,h))})}).catch(console.log)},s.skip=(t,u)=>{s.dInvoker(t);const o=n.voiceConnections.find(f=>f.channel.guild.id==t.guild.id);if(null===o)return t.channel.send(s.note('fail','No music being played.'));const r=s.getQueue(t.guild.id);if(!s.canSkip(t.member,r.songs))return t.channel.send(s.note('fail',`You cannot skip this as you didn't queue it.`)).then(f=>{f.delete(5e3)});let c=s.queues.get(t.guild.id);'none'!==c.loop&&('none'==c.loop,s.queues.set(t.guild.server,c));let g=1;!isNaN(u)&&0<parseInt(u)&&(g=parseInt(u)),g=Math.min(g,r.songs.length),r.songs.splice(0,g-1);try{const f=o.player.dispatcher;if((!f||null===f)&&s.logging)return console.log(new Error(`dispatcher null on skip cmd [${t.guild.name}] [${t.author.username}]`));o.paused&&f.resume(),f.end()}catch(f){s.logging&&console.log(new Error(`Skip command dispatcher error from userID ${t.author.id} in guildID ${t.guild.id}\n${f.stack}`));const h=f.toString().split(':');return t.channel.send(s.note('fail',`Error occoured!\n\`\`\`\n${h[0]}: ${h[1]}\n\`\`\``))}return s.queues.has(t.guild.id)&&'none'!==s.queues.get(t.guild.id).loop?t.channel.send(s.note('note','Skipped **'+g+'**! (Disabled Looping)')):t.channel.send(s.note('note','Skipped **'+g+'**!'))},s.queue=(t,u)=>{s.dInvoker(t);const o=s.getQueue(t.guild.id,!0);s.isQueueEmpty(s.queues.get(t.guild.id)).then(g=>{if(!0==g)return t.channel.send(s.note('note','Queue empty.'))}).catch(g=>{if(g)return console.log(`[isQueueEmpty] [queueCmd] [${t.guild.name}]: ${new Error(g)}`),t.channel.send(s.note('fail','Error occoured!'))});let r;if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const g=u?parseInt(u)-1:null;let f=o.length;if(!u){const h=new Discord.RichEmbed;if(25<o.length&&(f=25),s.enableQueueStat){let p='Stopped';const b=n.voiceConnections.find(v=>v.channel.guild.id==t.guild.id);if(null!==b){const v=b.player.dispatcher;p=v.paused?'Paused':'Playing',h.setAuthor(`Song Queue (${p})`,n.user.avatarURL)}else h.setAuthor(`Song Queue`,n.user.avatarURL)}try{for(var c=0;c<f;c++)o[c]!==o.last&&o[c]!==o.loop&&h.addField(`${o[c].channelTitle}`,`[${o[c].title}](${o[c].url})`,s.inlineEmbeds);h.setColor(s.embedColor),h.setFooter(`Total songs: ${o.length}`,t.author.displayAvatarURL)}catch(p){console.log(p.stack)}setTimeout(()=>{t.channel.send({embed:h})},1500)}else if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){if(g>o.length)return t.channel.send(s.note('fail','Not a valid song number.'));const h=new Discord.RichEmbed,p=n.users.get(o[g].requester);h.setAuthor(`Queued Song #${u}`,n.user.avatarURL),h.addField(o[g].channelTitle,`[${o[g].title}](${o[g].url})`,s.inlineEmbeds),h.addField(`Queued On`,o[g].queuedOn,s.inlineEmbeds),h.setThumbnail(o[g].thumbnails[s.thumbnailType].url),h.setColor(s.embedColor),s.requesterName&&p&&h.setFooter(`Queued by: ${p.username}`,o[g].requesterAvatarURL),s.requesterName&&!p&&h.setFooter(`Queued by: \`UnknownUser (id: ${o[g].requester})\``,o[g].requesterAvatarURL),t.channel.send({embed:h})}else;}else try{r=s.requesterName?o.map((g,f)=>f+1+': '+g.title+' | Requested by '+n.users.get(g.requester).username).join('\n'):o.map((g,f)=>f+1+': '+g.title).join('\n')}catch(g){s.logging&&console.log(`[${t.guild.name}] [queueCmd] `+g.stack);const f=g.toString().split(':');return t.channel.send(s.note('fail',`Error occoured!\n\`\`\`\n${f[0]}: ${f[1]}\n\`\`\``))}finally{if(1900<r.length){const g=r.substr(0,1899),f=r.substr(1900,r.length);if(1900<f.length){let h='Stopped';const p=n.voiceConnections.find(b=>b.channel.guild.id==t.guild.id);if(null!==p){const b=p.player.dispatcher;h=b.paused?'Paused':'Playing'}t.channel.send(s.note('wrap','Queue ('+h+'):\nPast character limit...'))}else if(s.enableQueueStat){let h='Stopped';const p=n.voiceConnections.find(b=>b.channel.guild.id==t.guild.id);if(null!==p){const b=p.player.dispatcher;h=b.paused?'Paused':'Playing'}t.channel.send(s.note('wrap','Queue ('+h+'):\n'+g)),t.channel.send(s.note('wrap','Queue (2) ('+h+'):\n'+f))}else t.channel.send(s.note('wrap','Queue:\n'+g)),t.channel.send(s.note('wrap','Queue (2):\n'+f))}else if(s.enableQueueStat){let g='Stopped';const f=n.voiceConnections.find(h=>h.channel.guild.id==t.guild.id);if(null!==f){const h=f.player.dispatcher;g=h.paused?'Paused':'Playing'}t.channel.send(s.note('wrap','Queue ('+g+'):\n'+r))}else t.channel.send(s.note('wrap','Queue:\n'+r))}},s.np=t=>{s.dInvoker(t);const o=n.voiceConnections.find(f=>f.channel.guild.id==t.guild.id),r=s.getQueue(t.guild.id,!0);if(null===o&&0<r.length)return t.channel.send(s.note('fail','No music is being played, but an ongoing queue is avainable.'));if(null===o)return t.channel.send(s.note('fail','No music is being played.'));o.player.dispatcher;if(s.isQueueEmpty(s.queues.get(t.guild.id)).then(f=>{if(!0==f)return t.channel.send(s.note('note','Queue empty.'))}).catch(f=>{if(f)return console.log(`[isQueueEmpty] [np] [${t.guild.name}]: ${new Error(f)}`),t.channel.send(s.note('fail','Error occoured!'))}),t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const f=new Discord.RichEmbed;try{f.setAuthor('Now Playing',n.user.avatarURL);var g=r[0].title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');f.setColor(s.embedColor),f.addField(r[0].channelTitle,`[${g}](${r[0].url})`,s.inlineEmbeds),f.addField('Queued On',r[0].queuedOn,s.inlineEmbeds),f.setThumbnail(r[0].thumbnails.high.url);const h=n.users.get(r[0].requester);s.requesterName&&h&&f.setFooter(`Requested by ${n.users.get(r[0].requester).username}`,r[0].requesterAvatarURL),s.requesterName&&!h&&f.setFooter(`Requested by \`UnknownUser (ID: ${r[0].requester})\``,r[0].requesterAvatarURL),t.channel.send({embed:f})}catch(h){console.error(`[${t.guild.name}] [npCmd] `+h.stack)}}else try{var g=r[0].title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');t.channel.send(`Now Playing: **${g}**\nRequested By: ${n.users.get(r[0].requester).username}\nQueued On: ${r[0].queuedOn}`)}catch(f){console.error(`[${t.guild.name}] [npCmd] `+f.stack)}},s.pause=t=>{s.dInvoker(t);const o=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null===o)return t.channel.send(s.note('fail','No music being played.'));if(!s.isAdmin(t.member)&&!s.anyoneCanPause)return t.channel.send(s.note('fail','Only Admins are allowed to use this command.'));const r=o.player.dispatcher;return r.paused?t.channel.send(s.note(`fail`,`Music already paused!`)):void(t.channel.send(s.note('note','Playback paused.')),!r.paused&&r.pause())},s.leave=t=>{if(s.dInvoker(t),s.isAdmin(t.member)||!0===s.anyoneCanLeave){const o=n.voiceConnections.find(r=>r.channel.guild.id==t.guild.id);if(null===o)return t.channel.send(s.note('fail','I\'m not in a voice channel.'));if(s.clearOnLeave&&s.emptyQueue(t.guild.id),!o.player.dispatcher)return;o.player.dispatcher.end(),o.disconnect(),t.channel.send(s.note('note','Successfully left your voice channel!')),setTimeout(()=>{let r=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(r.player.dispatcher)try{r.player.dispatcher.end(),r.disconnect()}catch(c){console.error(`[leaevCmd] [${t.guild.name}] ${c.stack}`)}},2500)}else{const o=Math.floor(100*Math.random()+1);return 10>=o?t.channel.send(s.note('fail',`I'm afraid I can't let you do that, ${t.author.username}.`)):t.channel.send(s.note('fail','Sorry, you\'re not allowed to do that.'))}},s.clearqueue=t=>{return s.dInvoker(t),s.queues.has(t.guild.id)?void(s.isAdmin(t.member)?s.emptyQueue(t.guild.id).then(()=>{const o=n.voiceConnections.find(r=>r.channel.guild.id==t.guild.id);null!==o&&(o.player.dispatcher.end(),o.disconnect()),t.channel.send(s.note('note','Queue cleared.'))}).catch(o=>{console.log(new Error(`[clearQueue] [${t.guild.name}] ${o}`))}):t.channel.send(s.note('fail',`I'm sorry, but you cannot do this.`))):t.channel.send(s.note('fail','No server queue.'))},s.resume=t=>{s.dInvoker(t);const o=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null===o)return t.channel.send(s.note('fail','No music is being played.'));if(!s.isAdmin(t.member)&&!s.anyoneCanPause)return t.channel.send(s.note('fail',`I'm sorry, but you cannot do this.`));t.channel.send(s.note('note','Playback resumed.'));const r=o.player.dispatcher;r.paused&&r.resume()},s.volume=(t,u)=>{s.dInvoker(t);const o=n.voiceConnections.find(g=>g.channel.guild.id==t.guild.id);if(null===o)return t.channel.send(s.note('fail','No music is being played.'));if(!u)return t.channel.send(s.note('fail','No volume specified.'));u=parseInt(u);const r=s.getQueue(t.guild.id,!0);if(!s.canAdjust(t.member,r))return t.channel.send(s.note('fail',`I'm sorry, but you cannot do that.`));const c=o.player.dispatcher;return 200<u||0>=u?t.channel.send(s.note('fail','Volume out of range, must be within 1 - 200')).then(g=>{g.delete(5e3)}):void(c.setVolume(u/100),t.channel.send(s.note('note','Volume set to '+u)))},s.loop=t=>{if(s.dInvoker(t),!s.queues.has(t.guild.id))return t.channel.send(s.note('fail',`No queue for this server found!`));var o=s.queues.get(t.guild.id);return'none'!=o.loop&&o.loop?'single'==o.loop?(o.loop='queue',s.queues.set(t.guild.id,o),t.channel.send(s.note('note','Looping queue enabled! :repeat:'))):'queue'==o.loop?('none'==o.loop,s.queues.set(t.guild.id,o),t.channel.send(s.note('note','Looping disabled! :arrow_forward:'))):void 0:(o.loop='single',s.queues.set(t.guild.id,o),t.channel.send(s.note('note','Looping single enabled! :repeat_one:')))},s.set=(t,u,o)=>{if(!s.isAdmin(t.member))return t.channel.send(s.note('fail',`Only admins may do this!`));const r=['prefix'];if(!o[0])return t.channel.send(s.note('note',`Valid settings are: ${r.join(', ')}.`));if(!r.includes(o[0]))return t.channel.send(s.note('fail','Not a valid setting!'));if(o[0]&&'prefix'==o[0]){const c=o.slice(1,o.length).join(' ');if(!c||1>c.legnth)return t.channel.send(s.note('fail','Please specify a prefix!'));s.updatePrefix(t.guild.id,c).then(g=>{g&&t.channel.send(s.note('note',g))}).catch(g=>{if(g)return t.channel.send(s.note('fail',`Error!\n${g}`)),console.log(`[updatePrefix] [${t.guild.id}] ${g}`)})}},s.executeQueue=(t,u)=>{if(0>=u.songs.length){const o=n.voiceConnections.find(r=>r.channel.guild.id==t.guild.id);if(null===o)return}s.isQueueEmpty(u).then(o=>{if(!0==o){t.channel.send(s.note('note','Playback finished.'));const r=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null!==r)return r.disconnect()}}).catch(o=>{if(o){console.error(`[executeQueue]: ${new Error(o)}`),t.channel.send(s.note('fail','Error occoured on starting the queue!'));const r=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null!==r)return r.disconnect()}}),new Promise((o,r)=>{const c=n.voiceConnections.find(g=>g.channel.guild.id==t.guild.id);null===c?t.member.voiceChannel&&t.member.voiceChannel.joinable?t.member.voiceChannel.join().then(g=>{o(g)}).catch(g=>{console.log(g)}):t.member.voiceChannel.joinable?s.emptyQueue(t.guild.id).then(()=>{r()}):(t.channel.send(s.note('fail','I do not have permission to join your voice channel!')),r()):o(c)}).then(o=>{const r=u.songs[0];try{s.getLast(t.guild.id).then(g=>{s.setLast(t.guild.id,r).then(()=>{const p=s.queues.get(t.guild.id);g!==r&&'none'==p.loop&&s.np(t)}).catch(h=>{return t.channel.send(s.note('fail','Error occoured, try again!')),console.error(new Error('Dispatcher SetLast: '+h))})}).catch(g=>{if(g)return t.channel.send(s.note('fail','Error occoured, try again!')),console.error(new Error('Dispatcher GetLast: '+g))});let c=o.playStream(ytdl(r.url,{filter:'audioonly'}),{volume:s.defVolume/100});o.on('error',g=>{console.log(`Dispatcher/connection: ${g}`),t&&t.channel&&t.channel.send(s.note('fail',`Dispatcher error!\n\`${g}\``)),u.songs.shift(),s.executeQueue(t,u)}),c.on('error',g=>{console.log(`Dispatcher: ${g.stack}`),t&&t.channel&&t.channel.send(s.note('fail',`Dispatcher error!\n\`${g}\``)),u.songs.shift(),s.executeQueue(t,u)}),c.on('end',()=>{setTimeout(()=>{let g=s.getQueue(t.guild.id);if('single'==g.loop)s.executeQueue(t,u);else if('queue'==g.loop)u.songs.push(u.songs[0]),u.songs.shift(),s.executeQueue(t,u);else if(0<u.songs.length)u.songs.shift(),s.executeQueue(t,u);else if(0>=u.songs.length){t&&t.channel&&t.channel.send(s.note('note','Playback finished.'));const f=n.voiceConnections.find(h=>h.channel.guild.id==t.guild.id);if(null!==f)return f.disconnect()}},1e3)})}catch(c){console.log(c)}}).catch(o=>{console.log(o)})},s.note=(t,u)=>{if('wrap'===t){let o=u.replace(/`/g,'`'+String.fromCharCode(8203)).replace(/@/g,'@'+String.fromCharCode(8203)).replace(n.token,'REMOVED');return'```\n'+o+'\n```'}return'note'===t?':musical_note: | '+u.replace(/`/g,'`'+String.fromCharCode(8203)):'search'===t?':mag: | '+u.replace(/`/g,'`'+String.fromCharCode(8203)):'fail'===t?':no_entry_sign: | '+u.replace(/`/g,'`'+String.fromCharCode(8203)):'font'===t?u.replace(/`/g,'`'+String.fromCharCode(8203)).replace(/@/g,'@'+String.fromCharCode(8203)).replace(/\\/g,'\\\\').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`'):void console.error(new Error(`${t} was an invalid type`))},exports.note=s.note,exports.addAdmin=t=>{return new Promise((u,o)=>{t&&'string'==typeof t||o('invalid admin object'),s.botAdmins.push(t),u(s.botAdmins)})},exports.getQueue=t=>{if(!t)return console.error(new Error('no server provided for getQueue')),null;let u=s.queues.has(t)?s.queues.get(t):null;return u},exports.setQueue=t=>{return new Promise((u,o)=>{t||o(new Error('no data passed to setQueue')),'string'==typeof t?(t={songs:[],last:null,loop:'none',id:t},s.queues.set(t.id,t),u(s.queues.get(t.id))):'object'==typeof t?((!t.songs||'object'!=typeof t.songs)&&(t.songs=[]),!t.last&&(t.last=null),(!t.loop||'string'!=typeof t.loop)&&(t.loop='none'),(!t.id||'string'!=typeof t.id)&&(t.id=t.toString()),s.queues.set(t.id,t),u(s.queues.get(t.id))):o(new Error('data didn\'t equal a string or object'))})}};
