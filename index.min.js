const ytdl=require('ytdl-core'),{YTSearcher}=require('ytsearcher'),ypi=require('youtube-playlist-info'),Discord=require('discord.js'),PACKAGE=require('./package.json');exports.start=(n,d)=>{var t=new class{constructor(s,o){this.commands=new Map,this.aliases=new Map,this.youtubeKey=o&&o.youtubeKey,this.botPrefix=o&&o.prefix||'!',this.embedColor=o&&o.embedColor||'GREEN',this.thumbnailType=o&&o.thumbnailType||'high',this.anyoneCanLeave=!!(o&&o.anyoneCanLeave||!1),this.global=o&&o.global||!1,this.maxQueueSize=parseInt(o&&o.maxQueueSize||100),this.defVolume=parseInt(o&&o.defVolume||50),this.anyoneCanSkip=!!(o&&o.anyoneCanSkip||!1),this.clearInvoker=!!(o&&o.clearInvoker||!1),this.helpCmd=o&&o.helpCmd||'musichelp',this.disableHelp=!!(o&&o.disableHelp||!1),this.helpHelp=o&&o.helpHelp||'Shows help for commands.',this.helpAlt=o&&o.helpAlt||[],this.playCmd=o&&o.playCmd||'play',this.disablePlay=!!(o&&o.disablePlay||!1),this.playHelp=o&&o.playHelp||'Queue a song/playlist by URL or search for a song.',this.playAlt=o&&o.playAlt||[],this.skipCmd=o&&o.skipCmd||'skip',this.disableSkip=!!(o&&o.disableSkip||!1),this.skipHelp=o&&o.skipHelp||'Skip a song or multi songs.',this.skipAlt=o&&o.skipAlt||[],this.joinCmd=o&&o.joinCmd||'join',this.disableJoin=!!(o&&o.disableJoin||!1),this.joinHelp=o&&o.joinHelp||'Join your current voice channel.',this.joinAlt=o&&o.joinAlt||[],this.queueCmd=o&&o.queueCmd||'queue',this.disableQueue=!!(o&&o.disableQueue||!1),this.queueHelp=o&&o.queueHelp||'Shows the current queue.',this.queueAlt=o&&o.queueAlt||[],this.pauseCmd=o&&o.pauseCmd||'pause',this.pauseHelp=o&&o.pauseHelp||'Pauses the queue.',this.disablePause=!!(o&&o.disablePause||!1),this.pauseAlt=o&&o.pauseAlt||[],this.resumeCmd=o&&o.resumeCmd||'resume',this.disableResume=!!(o&&o.disableResume||!1),this.resumeHelp=o&&o.resumeHelp||'Resume the queue.',this.resumeAlt=o&&o.resumeAlt||[],this.volumeCmd=o&&o.volumeCmd||'volume',this.disableVolume=!!(o&&o.disableVolume||!1),this.volumeHelp=o&&o.volumeHelp||'Adjusts the volume of the bot.',this.volumeAlt=o&&o.volumeAlt||[],this.leaveCmd=o&&o.leaveCmd||'leave',this.disableLeave=!!(o&&o.disableLeave||!1),this.leaveHelp=o&&o.leaveHelp||'Leave and clear the queue.',this.leaveAlt=o&&o.leaveAlt||[],this.clearCmd=o&&o.clearCmd||'clearqueue',this.disableClear=!!(o&&o.disableClear||!1),this.clearHelp=o&&o.clearHelp||'Clears the current queue.',this.clearAlt=o&&o.clearAlt||[],this.searchCmd=o&&o.searchCmd||'search',this.disableSearch=!!(o&&o.disableSearch||!1),this.searchHelp=o&&o.searchHelp||'Searchs for up to 10 results.',this.searchAlt=o&&o.searchAlt||[],this.loopCmd=o&&o.loopCmd||'loop',this.disableLoop=!!(o&&o.disableLoop||!1),this.loopHelp=o&&o.loopHelp||'Changes the loop state.',this.loopAlt=o&&o.loopAlt||[],this.setCmd=o&&o.setCmd||'set',this.disableSet=!!(o&&o.disableSet||!1),this.setHelp=o&&o.setHelp||'Changes settings for the server. Use without specifing a setting to see valid settings.',this.setAlt=o&&o.setAlt||[],this.ownerCmd=o&&o.ownerCmd||'owner',this.disableOwnerCmd=!!(o&&o.disableOwnerCmd||!1),this.ownerHelp=o&&o.ownerHelp||'Owner commands and functions.',this.ownerAlt=o&&o.ownerAlt||[],this.npCmd=o&&o.npCmd||'np',this.disableNp=!!(o&&o.disableNp||!1),this.npHelp=o&&o.npHelp||'Shows the currently playing song.',this.npAlt=o&&o.npAlt||[],this.enableQueueStat=!!(o&&o.enableQueueStat||!1),this.anyoneCanAdjust=!!(o&&o.anyoneCanAdjust||!1),this.ownerOverMember=!!(o&&o.ownerOverMember||!1),this.botOwner=o&&o.botOwner||null,this.logging=!!(o&&o.logging||!1),this.enableAliveMessage=!!(o&&o.enableAliveMessage||!1),this.aliveMessage=o&&o.aliveMessage||'',this.aliveMessageTime=parseInt(o&&o.aliveMessageTime||6e5),this.requesterName=!!(o&&o.requesterName||!1),this.inlineEmbeds=!!(o&&o.inlineEmbeds||!1),this.maxWait=parseInt(o&&o.maxWait||15000),this.anyoneCanPause=!!(o&&o.anyoneCanPause||!0),this.dateLocal=o&&o.dateLocal||'en-US',this.clearOnLeave=o&&o.clearOnLeave||!1,this.checkQueues=o&&o.checkQueues||!1,this.queues=new Map,this.botPrefixs=new Map,this.advancedMode=o&&o.advancedMode||{},this.botAdmins=o&&o.botAdmins||[]}logger(s,o,u){console.log(`[${s}] [${o.guild.name}] ${u}`)}}(n,d);exports.bot=t,t.advancedMode&&t.advancedMode.enabled&&(t.advancedMode={enabled:!!(d&&d.advancedMode.enabled||!1),multiPrefix:!!(d&&d.advancedMode.multiPrefix||!1),serverPrefixs:d&&d.advancedMode.serverPrefixs||{}});(async function(){8>process.version.slice(1).split('.')[0]&&(console.error(new Error(`[MusicBot] node 8 or higher is needed, please update`)),process.exit(1)),t.disableLeave&&t.disableSkip&&t.disablePlay&&t.disableQueue&&t.disableHelp&&t.disableResume&&t.disablePause&&t.disableLoop&&t.disableClear&&t.disableNp&&t.disableSearch&&t.disableVolume&&(console.error(new Error(`all commands disabled`)),process.exit(1)),'object'!=typeof t.embedColor&&'number'!=typeof t.embedColor&&'string'!=typeof t.embedColor&&(console.error(new TypeError(`embedColor must be an object (array), number, or a string`)),process.exit(1)),'object'!=typeof t.botAdmins&&(console.error(new TypeError(`botAdmins must be an object (array)`)),process.exit(1)),'boolean'!=typeof t.clearOnLeave&&(console.error(new TypeError(`clearOnLeave must be a boolean`)),process.exit(1)),'boolean'!=typeof t.checkQueues&&(console.error(new TypeError(`checkQueues must be a boolean`)),process.exit(1)),'string'!=typeof t.dateLocal&&(console.error(new TypeError(`dateLocal must be a string`)),process.exit(1)),'object'!=typeof t.advancedMode&&(console.error(new TypeError(`advancedMode must be an object`)),process.exit(1)),t.advancedMode.enabled&&'boolean'!=typeof t.advancedMode.enabled&&(console.error(new TypeError(`advancedMode.enabled must be a boolean`)),process.exit(1)),t.advancedMode.multiPrefix&&'boolean'!=typeof t.advancedMode.multiPrefix&&(console.error(new TypeError(`advancedMode.multiPrefix must be a boolean`)),process.exit(1)),t.advancedMode.serverPrefixs&&'object'!=typeof t.advancedMode.serverPrefixs&&(console.error(new TypeError(`advancedMode.serverPrefixs must be an object`)),process.exit(1)),'string'!=typeof t.thumbnailType&&(console.error(new TypeError(`thumbnailType must be a string`)),process.exit(1));t.thumbnailType.match(/default|medium|high/)||(console.error(new Error(`thumbnailType must be one of the following: default, medium, high`)),process.exit(1));'string'!=typeof t.helpHelp&&(console.error(new TypeError(`helpHelp must be a string`)),process.exit(1));'object'!=typeof t.helpAlt&&(console.error(new TypeError(`helpAlt must be an array`)),process.exit(1));'string'!=typeof t.playHelp&&(console.error(new TypeError(`playHelp must be a string`)),process.exit(1));'object'!=typeof t.playAlt&&(console.error(new TypeError(`playAlt must be an array`)),process.exit(1));'string'!=typeof t.queueHelp&&(console.error(new TypeError(`queueHelp must be a string`)),process.exit(1));'object'!=typeof t.queueAlt&&(console.error(new TypeError(`queueAlt must be an array`)),process.exit(1));'string'!=typeof t.pauseHelp&&(console.error(new TypeError(`pauseHelp must be a string`)),process.exit(1));'object'!=typeof t.pauseAlt&&(console.error(new TypeError(`pauseAlt must be an array`)),process.exit(1));'string'!=typeof t.resumeHelp&&(console.error(new TypeError(`resumeHelp must be a string`)),process.exit(1));'object'!=typeof t.resumeAlt&&(console.error(new TypeError(`resumeAlt must be an array`)),process.exit(1));'string'!=typeof t.volumeHelp&&(console.error(new TypeError(`volumeHelp must be a string`)),process.exit(1));'object'!=typeof t.volumeAlt&&(console.error(new TypeError(`volumeAlt must be an array`)),process.exit(1));'string'!=typeof t.leaveHelp&&(console.error(new TypeError(`leaveHelp must be a string`)),process.exit(1));'object'!=typeof t.leaveAlt&&(console.error(new TypeError(`leaveAlt must be an array`)),process.exit(1));'string'!=typeof t.clearHelp&&(console.error(new TypeError(`clearHelp must be a string`)),process.exit(1));'object'!=typeof t.clearAlt&&(console.error(new TypeError(`clearAlt must be an array`)),process.exit(1));'string'!=typeof t.loopHelp&&(console.error(new TypeError(`loopHelp must be a string`)),process.exit(1));'object'!=typeof t.loopAlt&&(console.error(new TypeError(`loopAlt must be an array`)),process.exit(1));'string'!=typeof t.npHelp&&(console.error(new TypeError(`npHelp must be a string`)),process.exit(1));'object'!=typeof t.npAlt&&(console.error(new TypeError(`npAlt must be an array`)),process.exit(1));'string'!=typeof t.ownerHelp&&(console.error(new TypeError(`ownerHelp must be a string`)),process.exit(1));'object'!=typeof t.ownerAlt&&(console.error(new TypeError(`ownerAlt must be an array`)),process.exit(1));'string'!=typeof t.skipHelp&&(console.error(new TypeError(`skipHelp must be a string`)),process.exit(1));'object'!=typeof t.skipAlt&&(console.error(new TypeError(`skipAlt must be an array`)),process.exit(1));t.youtubeKey||(console.error(new Error(`youtubeKey is required but missing`)),process.exit(1));t.youtubeKey&&'string'!=typeof t.youtubeKey&&(console.error(new TypeError(`youtubeKey must be a string`)),process.exit(1));'boolean'!=typeof t.disableHelp&&(console.error(new TypeError(`disableHelp must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disablePlay&&(console.error(new TypeError(`disablePlay must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableSkip&&(console.error(new TypeError(`disableSkip must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableQueue&&(console.error(new TypeError(`disableQueue must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disablePause&&(console.error(new TypeError(`disablePause must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableResume&&(console.error(new TypeError(`disableResume must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableLeave&&(console.error(new TypeError(`disableLeave must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableClear&&(console.error(new TypeError(`disableClear must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableLoop&&(console.error(new TypeError(`disableLoop must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableNp&&(console.error(new TypeError(`disableNp must be a boolean`)),process.exit(1)),'boolean'!=typeof t.disableOwnerCmd&&(console.error(new TypeError(`disableOwnerCmd must be a boolean`)),process.exit(1)),'string'!=typeof t.ownerCmd&&(console.error(new TypeError(`ownerCmd must be a string`)),process.exit(1)),'boolean'!=typeof t.ownerOverMember&&(console.error(new TypeError(`ownerOverMember must be a boolean`)),process.exit(1));t.ownerOverMember&&'string'!=typeof t.botOwner&&(console.error(new TypeError(`botOwner must be a string`)),process.exit(1));'string'!=typeof t.botPrefix&&(console.error(new TypeError(`prefix must be a string`)),process.exit(1));(1>t.botPrefix.length||10<t.botPrefix.length)&&(console.error(new RangeError(`prefix length must be between 1 and 10`)),process.exit(1));'boolean'!=typeof t.global&&(console.error(new TypeError(`global must be a boolean`)),process.exit(1));'number'!=typeof t.maxQueueSize&&(console.error(new TypeError(`maxQueueSize must be a number`)),process.exit(1));Number.isInteger(t.maxQueueSize)||(console.error(new TypeError(`maxQueueSize must be an integer`)),process.exit(1));'number'!=typeof t.defVolume&&(console.error(new TypeError(`defaultVolume must be a number`)),process.exit(1));(!Number.isInteger(t.defVolume)||1>t.defVolume||200<t.defVolume)&&(console.error(new TypeError(`defaultVolume must be an integer between 1 and 200`)),process.exit(1));'boolean'!=typeof t.anyoneCanSkip&&(console.error(new TypeError(`anyoneCanSkip must be a boolean`)),process.exit(1));'boolean'!=typeof t.clearInvoker&&(console.error(new TypeError(`clearInvoker must be a boolean`)),process.exit(1));'boolean'!=typeof t.enableAliveMessage&&(console.error(new TypeError(`enableAliveMessage must be a boolean`)),process.exit(1));'string'!=typeof t.aliveMessage&&(console.error(new TypeError(`aliveMessage must be a string`)),process.exit(1));'number'!=typeof t.aliveMessageTime&&(console.error(new TypeError(`aliveMessageTime must be a number`)),process.exit(1));'string'!=typeof t.helpCmd&&(console.error(new TypeError(`helpCmd must be a string`)),process.exit(1));'string'!=typeof t.playCmd&&(console.error(new TypeError(`playCmd must be a string`)),process.exit(1));'string'!=typeof t.searchCmd&&(console.error(new TypeError(`searchCmd must be a string`)),process.exit(1));'boolean'!=typeof t.disableSearch&&(console.error(new TypeError(`disableSearch must be a boolean`)),process.exit(1));'string'!=typeof t.skipCmd&&(console.error(new TypeError(`skipCmd must be a string`)),process.exit(1));'string'!=typeof t.queueCmd&&(console.error(new TypeError(`queueCmd must be a string`)),process.exit(1));'string'!=typeof t.pauseCmd&&(console.error(new TypeError(`pauseCmd must be a string`)),process.exit(1));'string'!=typeof t.npCmd&&(console.error(new TypeError(`npCmd must be a string`)),process.exit(1));'string'!=typeof t.resumeCmd&&(console.error(new TypeError(`resumeCmd must be a string`)),process.exit(1));'string'!=typeof t.volumeCmd&&(console.error(new TypeError(`volumeCmd must be a string`)),process.exit(1));'string'!=typeof t.leaveCmd&&(console.error(new TypeError(`leaveCmd must be a string`)),process.exit(1));'string'!=typeof t.clearCmd&&(console.error(new TypeError(`clearCmd must be a string`)),process.exit(1));'string'!=typeof t.loopCmd&&(console.error(new TypeError(`loopCmd must be a string`)),process.exit(1));'boolean'!=typeof t.enableQueueStat&&(console.error(new TypeError(`enableQueueStat must be a boolean`)),process.exit(1));'boolean'!=typeof t.anyoneCanAdjust&&(console.error(new TypeError(`anyoneCanAdjust must be a boolean`)),process.exit(1));'boolean'!=typeof t.logging&&(console.error(new TypeError(`logging must be a boolean`)),process.exit(1));'boolean'!=typeof t.requesterName&&(console.error(new TypeError(`requesterName must be a boolean`)),process.exit(1));'boolean'!=typeof t.inlineEmbeds&&(console.error(new TypeError(`inlineEmbeds must be a boolean`)),process.exit(1));'string'!=typeof t.joinCmd&&(console.error(new TypeError(`joinCmd must be a string`)),process.exit(1)),'boolean'!=typeof t.disableJoin&&(console.error(new TypeError(`disableJoin must be a boolean`)),process.exit(1)),'object'!=typeof t.joinAlt&&(console.error(new TypeError(`joinAlt must be an object (array)`)),process.exit(1)),'string'!=typeof t.joinHelp&&(console.error(new TypeError(`joinHelp must be a string`)),process.exit(1)),t.global&&50>t.maxQueueSize&&console.warn(`global queues are enabled while maxQueueSize is below 50! Recommended to use a higher size.`);try{if(!t.commands.has(t.helpCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.helpCmd} command.`);const s={name:t.helpCmd,usage:`${t.botPrefix}${t.helpCmd} [command]`,disabled:t.disableHelp,help:t.helpHelp,aliases:t.helpAlt,admin:!1,run:'musichelp'};t.commands.set(t.helpCmd,s),0<t.helpAlt.length&&t.helpAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.searchCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.searchCmd} command.`);const s={name:t.searchCmd,usage:`${t.botPrefix}${t.searchCmd} <query>`,disabled:t.disableSearch,help:t.searchHelp,aliases:t.searchAlt,admin:!1,run:'search'};t.commands.set(t.searchCmd,s),0<t.searchAlt.length&&t.searchAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.playCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.playCmd} command.`);const s={name:t.playCmd,usage:`${t.botPrefix}${t.playCmd} <song to queue>`,disabled:t.disablePlay,help:t.playHelp,aliases:t.playAlt,admin:!1,run:'play'};t.commands.set(t.playCmd,s),0<t.playAlt.length&&t.playAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.skipCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.skipCmd} command.`);const s={name:t.skipCmd,usage:`${t.botPrefix}${t.skipCmd} [numberOfSongs]`,disabled:t.disableSkip,help:t.skipHelp,aliases:t.skipAlt,admin:!0,run:'skip'};t.commands.set(t.skipCmd,s),0<t.skipAlt.length&&t.skipAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.queueCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.queueCmd} command.`);const s={name:t.queueCmd,usage:`${t.botPrefix}${t.queueCmd} [songNumber]`,disabled:t.disableQueue,help:t.queueHelp,aliases:t.queueAlt,admin:!1,run:'queue'};t.commands.set(t.queueCmd,s),0<t.queueAlt.length&&t.queueAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.pauseCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.pauseCmd} command.`);const s={name:t.pauseCmd,usage:null,disabled:t.disablePause,help:t.pauseHelp,aliases:t.pauseAlt,admin:!1,run:'pause'};t.commands.set(t.pauseCmd,s),0<t.pauseAlt.length&&t.pauseAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.resumeCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.resumeCmd} command.`);const s={name:t.resumeCmd,usage:null,disabled:t.disableResume,help:t.resumeHelp,aliases:t.resumeAlt,admin:!1,run:'resume'};t.commands.set(t.resumeCmd,s),0<t.resumeAlt.length&&t.resumeAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.volumeCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.volumeCmd} command.`);const s={name:t.volumeCmd,usage:`${t.botPrefix}${t.volumeCmd} <1 - 200>`,disabled:t.disableVolume,help:t.volumeHelp,aliases:t.volumeAlt,admin:!1,run:'volume'};t.commands.set(t.volumeCmd,s),0<t.volumeAlt.length&&t.volumeAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.clearCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.clearCmd} command.`);const s={name:t.clearCmd,usage:null,disabled:t.disableClear,help:t.clearHelp,aliases:t.clearAlt,admin:!1,run:'clearqueue'};t.commands.set(t.clearCmd,s),0<t.clearAlt.length&&t.clearAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.npCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.npCmd} command.`);const s={name:t.npCmd,usage:null,disabled:t.disableNp,help:t.npHelp,aliases:t.npAlt,admin:!1,run:'np'};t.commands.set(t.npCmd,s),0<t.npAlt.length&&t.npAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.leaveCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.leaveCmd} command.`);const s={name:t.leaveCmd,usage:null,disabled:t.disableLeave,help:t.leaveHelp,aliases:t.leaveAlt,admin:!1,run:'leave'};t.commands.set(t.leaveCmd,s),0<t.leaveAlt.length&&t.leaveAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.loopCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.loopCmd} command.`);const s={name:t.loopCmd,usage:null,disabled:t.disableLoop,help:t.loopHelp,aliases:t.loopAlt,admin:!1,run:'loop'};t.commands.set(t.loopCmd,s),0<t.loopAlt.length&&t.loopAlt.forEach(o=>{t.aliases.set(o,s)})}if(!t.commands.has(t.setCmd)){t.logging&&console.log(`[MUSIC] Mapping ${t.setCmd} command.`);const s={name:t.setCmd,usage:`${t.botPrefix}${t.setCmd} <setting>`,disabled:t.disableSet,help:t.setHelp,aliases:t.setAlt,admin:!1,run:'set'};t.commands.set(t.setCmd,s),0<t.setAlt.length&&t.setAlt.forEach(o=>{t.aliases.set(o,s)})}}catch(s){console.error(s.stack),process.exit(1)}})(),t.searcher=new YTSearcher({key:t.youtubeKey,revealkey:!0}),exports.changeKey=s=>{return new Promise((o,u)=>{s&&'string'==typeof s||u('invalid key provided'),t.youtubeKey=s,t.searcher=new YTSearcher({key:s,revealkey:!0}),o(t)})},n.on('message',s=>{const o=s.content.trim();if(t.advancedMode.enabled&&t.advancedMode.multiPrefix){if(t.botPrefixs.has(s.guild.id)){const u=t.botPrefixs.get(s.guild.id).prefix;if(!o.startsWith(u))return;const r=o.substring(u.toString().length).split(/[ \n]/)[0].trim(),c=o.substring(u.toString().length+r.length).trim(),f=o.slice(u.toString().length+r.length).trim().split(/ +/g);if(t.commands.has(r)){let h=t.commands.get(r);if(!h.disabled)return t[h.run](s,c,f)}else if(t.aliases.has(r)){let h=t.aliases.get(r);if(!h.disabled)return t[h.run](s,c,f)}}else if(o.startsWith(t.botPrefix)){const u=o.substring(t.botPrefix.length).split(/[ \n]/)[0].trim(),r=o.substring(t.botPrefix.length+u.length).trim(),c=o.slice(t.botPrefix.length+u.length).trim().split(/ +/g);if(t.commands.has(u)){let f=t.commands.get(u);if(!f.disabled)return t[f.run](s,r,c)}else if(t.aliases.has(u)){let f=t.aliases.get(u);if(!f.disabled)return t[f.run](s,r,c)}}}else if(o.startsWith(t.botPrefix)){const u=o.substring(t.botPrefix.length).split(/[ \n]/)[0].trim(),r=o.substring(t.botPrefix.length+u.length).trim(),c=o.slice(t.botPrefix.length+u.length).trim().split(/ +/g);if(t.commands.has(u)){let f=t.commands.get(u);if(!f.disabled)return t[f.run](s,r,c)}else if(t.aliases.has(u)){let f=t.aliases.get(u);if(!f.disabled)return t[f.run](s,r,c)}}}),n.on('ready',()=>{t.advancedMode&&!0===t.advancedMode.enabled&&t.advancedMode&&!0===t.advancedMode.multiPrefix&&'object'==typeof t.advancedMode.serverPrefixs&&n.guilds.forEach(s=>{if(t.advancedMode.serverPrefixs.has(s.id)){var o=t.advancedMode.serverPrefixs.get(s.id);let u={id:s.id,prefix:o.prefix};t.botPrefixs.set(s.id,u)}else{let u={id:s.id,prefix:t.botPrefix};t.botPrefixs.set(s.id,u)}});t.enableAliveMessage&&setInterval(function(){t.aliveMessage=3>t.aliveMessage.length?`----------------------------------\n${n.user.username} online since ${n.readyAt}!\n----------------------------------`:t.aliveMessage.replace(/{{username}}/g,`${n.user.username}`).replace(/{{starttime}}/g,`${n.readyAt}`),console.log(t.aliveMessage)},t.aliveMessageTime);console.log(`------- ${n.user.username} -------\n> Version: ${PACKAGE.version}\n> Extra Logging: ${t.logging}.\n> Using Global Queue: ${t.global}.\n> Node.js Version: ${process.version}\n------- ${n.user.username} -------`),t.enableQueueStat||console.log(`[MUSIC] enableQueueStat is 'false'. Queue will not have a Playing/Paused indicator.`),!0==t.checkQueues&&(console.warn(`[MUSIC] checkQueues is enabled.`),t.verify=s=>{return new Promise((o,u)=>{s?s&&null==s.songs?u(1):s&&s.songs.length>t.maxQueueSize&&0!==t.maxQueueSize?u(1):s&&0>s.songs.length?u(1):s&&'string'!=typeof s.loop?u(2):s&&!s.id&&u(3):u(0),s.songs.forEach(r=>{r.title&&r.url&&r.queuedOn&&r.requester||u(4)}),o('pass')})},exports.verifyQueue=t.verify,setInterval(()=>{t.queues.forEach(s=>{t.verify(s).then(()=>{t.logging&&console.log(`[Check Queues Music] Queue ${s.id} passed verification.`)}).catch(o=>{if(0<=o){let u={songs:[],last:null,loop:'none',id:`${s.toString()}`};t.queues.set(s.id,u)}try{const u=n.voiceConnections.find(r=>`${s.toString()}`==r.channel.guild.id);null!==u&&(u.player.dispatcher.end(),u.disconnect())}catch(u){console.error(u)}})})},3.6e6))}),t.updatePrefix=(s,o)=>{if(t&&t.advancedMode.enabled&&t.advancedMode.multiPrefix)return new Promise((u,r)=>{'string'!=typeof s&&r(`server was not a string`),'string'!=typeof o&&r(`prefix was not a string`);let c;if(t.botPrefixs.has(s))c=t.botPrefixs.get(s),c.prefix=o,t.botPrefixs.set(s,c),u(`Prefix updated to \`${o}\`!`);else{t.botPrefixs.set(s,{id:s,prefix:o}),u(`Prefix updated to \`${o}\`!`)}})},t.isAdmin=s=>{return t.ownerOverMember&&s.id===t.botOwner||!!t.botAdmins.includes(s.id)||s.hasPermission('ADMINISTRATOR')},t.canSkip=(s,o)=>{return!!t.anyoneCanSkip||!!t.botAdmins.includes(s.id)||t.ownerOverMember&&s.id===t.botOwner||o[0].requester===s.id||!!t.isAdmin(s)},t.canAdjust=(s,o)=>{return!!t.anyoneCanAdjust||!!t.botAdmins.includes(s.id)||t.ownerOverMember&&s.id===t.botOwner||o[0].requester===s.id||!!t.isAdmin(s)},t.dInvoker=s=>{if(t.clearInvoker){if(!s)return;s.delete()}},t.getQueue=(s,o)=>{if(t.global&&(s='_'),!t.queues.has(s)){let u={songs:[],last:null,loop:'none',id:s};t.queues.set(s,u)}return!0==o?t.queues.get(s).songs:o&&!1!=o?void 0:t.queues.get(s)},t.setLast=(s,o)=>{return new Promise((u,r)=>{let c;t.queues.has(s)?(c=t.queues.get(s),c.last=o,t.queues.set(s,c),u(t.queues.get(s))):r('no server queue')})},t.getLast=s=>{return new Promise(o=>{let r=t.queues.has(s)?t.queues.get(s).last:null;r&&r.last?r.last&&o(r.last):o(null)})},t.isQueueEmpty=s=>{return new Promise((o,u)=>{s||u('no queue passed');'object'==typeof s?0<s.length?o(!1):0>=s.length&&o(!0):s&&s.songs?0<s.songs.length?o(!1):0>=s.songs.length&&o(!0):u('no queue/songs found')})},exports.isQueueEmpty=t.isQueueEmpty,t.emptyQueue=s=>{return new Promise((o,u)=>{let r=t.queues.has(s)?t.queues.get(s):null;r||u(new Error(`[emptyQueue] no queue found for ${s}`));t.queues.set(s,{songs:[],last:null,loop:'none',id:s}),o(t.queues.get(s))})},t.musichelp=(s,o)=>{t.dInvoker(s);let u=o.trim();if(!o){if(s.channel.permissionsFor(s.guild.me).has('EMBED_LINKS')){const h=new Discord.RichEmbed;h.setAuthor('Commands',s.author.displayAvatarURL),h.setDescription(`Use \`${t.botPrefix}${t.helpCmd} command name\` for help on usage.`);const g=Array.from(t.commands);for(var r=0;r<g.length;r++){let p=g[r][1];p.disabled||h.addField(p.name,p.help)}h.setColor(t.embedColor),setTimeout(()=>{if(t.messageHelp){let p=!1;s.author.send({embed:h}).then(()=>{p=!0}),setTimeout(()=>{if(!p)return s.channel.send({embed:h})},1200)}else return s.channel.send({embed:h})},1500)}else{var c=`= Music Commands =\nUse ${t.botPrefix}${t.helpCmd} [command] for help on a command.\n`;const h=Array.from(t.commands);for(var r=0;r<h.length;r++){let g=h[r][1];g.disabled||(c+=`\n• ${g.name}: ${g.help}`)}setTimeout(()=>{if(t.messageHelp){let g=!1;s.author.send(c,{code:'asciidoc'}).then(()=>{g=!0}),setTimeout(()=>{if(!g)return s.channel.send(c,{code:'asciidoc'})},500)}else return s.channel.send(c,{code:'asciidoc'})},1500)}}else if(!(t.commands.has(u)||t.aliases.has(u)))s.channel.send(t.note('fail',`${o} is not a valid command!`));else if(s.channel.permissionsFor(s.guild.me).has('EMBED_LINKS')){const h=new Discord.RichEmbed;u=t.commands.get(u)||t.aliases.get(u),h.setAuthor(u.name,s.client.user.avatarURL),h.setDescription(u.help),0<u.aliases.length&&h.addField(`Aliases`,u.aliases.join(', '),t.inlineEmbeds),null!==u.usage&&h.addField(`Usage`,u.usage,t.inlineEmbeds),h.setColor(t.embedColor),s.channel.send({embed:h})}else{u=t.commands.get(u)||t.aliases.get(u);var f=`= ${u.name} =\n`;f+`\n${u.help}`,null!==u.usage&&(f+=`\nUsage: ${u.usage}\n`),0<u.aliases.length&&(f+=`\nAliases: ${u.aliases.join(', ')}`),s.channel.send(f,{code:'asciidoc'})}},t.play=(s,o)=>{if(t.dInvoker(s),void 0===s.member.voiceChannel)return s.channel.send(t.note('fail',`You're not in a voice channel.`));if(!o)return s.channel.send(t.note('fail','No video specified!'));const u=t.getQueue(s.guild.id);if(u.songs.length>=t.maxQueueSize&&0!==t.maxQueueSize)return s.channel.send(t.note('fail','Maximum queue size reached!'));var r=o.trim();s.channel.send(t.note('search',`Searching: \`${r}\``)).then(c=>{if(r.startsWith('http')&&r.includes('list=')){var f=r.toString().split('list=')[1];f.toString().includes('?')&&(f=f.split('?')[0]),f.toString().includes('&t=')&&(f=f.split('&t=')[0]),ypi.playlistInfo(t.youtubeKey,f,function(h){const g=Array.from(h);var p=0,b=0;g.forEach(v=>{(b++,u.songs.length!=t.maxQueueSize+1||0===t.maxQueueSize)&&('youtube#video'==v.resourceId.kind&&(!v.url&&(v.url=`https://www.youtube.com/watch?v=`+v.resourceId.videoId),v.requester=s.author.id,v.queuedOn=new Date().toLocaleDateString(t.dateLocal,{weekday:'long',hour:'numeric'}),t.requesterName&&(v.requesterAvatarURL=s.author.displayAvatarURL),u.songs.push(v),1===u.songs.length&&t.executeQueue(s,u),p++),b==g.length&&((p=0)?s.channel.send(t.note('fail',`Coudln't get any songs from that playlist.`)):1==p?s.channel.send(t.note('note',`Queued one song.`)):1<p&&s.channel.send(t.note('note',`Queued ${p} songs.`))))})})}else t.searcher.search(r,{type:'video'}).then(h=>{if(!h.totalResults||0===h.totalResults)return c.edit(t.note('fail','Failed to get search results.'));var g=h.first;if(g.requester=s.author.id,g.channelURL=`https://www.youtube.com/channel/${g.channelId}`,g.queuedOn=new Date().toLocaleDateString(t.dateLocal,{weekday:'long',hour:'numeric'}),t.requesterName&&(g.requesterAvatarURL=s.author.displayAvatarURL),u.songs.push(g),1<u.songs.length)if(s.channel.permissionsFor(s.guild.me).has('EMBED_LINKS')){const b=new Discord.RichEmbed;try{b.setAuthor('Adding To Queue',n.user.avatarURL);var p=g.title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');b.setColor(t.embedColor),b.addField(g.channelTitle,`[${p}](${g.url})`,t.inlineEmbeds),b.addField('Queued On',g.queuedOn,t.inlineEmbeds),b.setThumbnail(g.thumbnails.high.url);const v=n.users.get(g.requester);t.requesterName&&v&&b.setFooter(`Requested by ${n.users.get(g.requester).username}`,g.requesterAvatarURL),t.requesterName&&!v&&b.setFooter(`Requested by \`UnknownUser (ID: ${g.requester})\``,g.requesterAvatarURL),s.channel.send({embed:b})}catch(v){console.error(`[${s.guild.name}] [npCmd] `+v.stack)}}else try{var p=g.title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');s.channel.send(`Now Playing: **${p}**\nRequested By: ${n.users.get(g.requester).username}\nQueued On: ${g.queuedOn}`)}catch(b){console.error(`[${s.guild.name}] [npCmd] `+b.stack)}1!==u.songs.length&&n.voiceConnections.find(b=>b.channel.guild.id==s.guild.id)||t.executeQueue(s,u)})}).catch(console.log)},t.search=(s,o)=>{if(t.dInvoker(s),void 0===s.member.voiceChannel)return s.channel.send(t.note('fail',`You're not in a voice channel~`));if(!o)return s.channel.send(t.note('fail','No video specified!'));const u=t.getQueue(s.guild.id);if(u.songs.length>=t.maxQueueSize&&0!==t.maxQueueSize)return s.channel.send(t.note('fail','Maximum queue size reached!'));var r=o.trim();s.channel.send(t.note('search',`Searching: \`${r}\``)).then(c=>{t.searcher.search(r,{type:'video'}).then(f=>{if(!f.totalResults||0===f.totalResults)return c.edit(t.note('fail','Failed to get search results.'));const h=async(C,x)=>{const y=new Discord.RichEmbed;y.setTitle(`Choose Your Video`),y.setColor(t.embedColor);var A=0;C.forEach(function(k){A++,y.addField(`${A} (${k.channelTitle})`,`[${t.note('font',k.title)}](${k.url})`,t.inlineEmbeds)}),y.setFooter(`Search by: ${s.author.username}`,s.author.displayAvatarURL),s.channel.send({embed:y}).then(k=>{var S=null;0===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||`cancel`===P.content.trim():1===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||`cancel`===P.content.trim():2===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||`cancel`===P.content.trim():3===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||`cancel`===P.content.trim():4===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||`cancel`===P.content.trim():5===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||`cancel`===P.content.trim():6===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||`cancel`===P.content.trim():7===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||P.content.includes('8')||`cancel`===P.content.trim():8===x?S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||P.content.includes('8')||P.content.includes('9')||`cancel`===P.content.trim():9==x&&(S=P=>P.author.id===s.author.id&&P.content.includes('1')||P.content.includes('2')||P.content.includes('3')||P.content.includes('4')||P.content.includes('5')||P.content.includes('6')||P.content.includes('7')||P.content.includes('8')||P.content.includes('9')||P.content.includes('10')||`cancel`===P.content.trim()),s.channel.awaitMessages(S,{max:1,time:6e4,errors:['time']}).then(P=>{const Q=Array.from(P),L=Q[0][1].content;if('cancel'===L)return k.edit(t.note('note','Searching canceled.'));const E=parseInt(L)-1;if(0<=E)return k.delete(),s.channel.send(t.note('note',`Queued **${t.note('font',C[E].title)}**`)).then(()=>{u.songs.push(C[E]),1!==u.songs.length&&n.voiceConnections.find(H=>H.channel.guild.id==s.guild.id)||t.executeQueue(s,u)}).catch(console.log)}).catch(P=>{return P.toString().match(/error|Error|TypeError|RangeError|Uncaught/)?k.edit(`\`\`\`xl\nSearching canceled. ${P}\n\`\`\``):k.edit(`\`\`\`xl\nSearching canceled.\n\`\`\``)})})},g=10<=f.totalResults?9:f.totalResults-1;for(var v,p=[],b=0;99>b;b++)v=f.currentPage[b],v.requester=s.author.id,t.requesterName&&(v.requesterAvatarURL=s.author.displayAvatarURL),v.channelURL=`https://www.youtube.com/channel/${v.channelId}`,v.queuedOn=new Date().toLocaleDateString(t.dateLocal,{weekday:'long',hour:'numeric'}),p.push(v),b===g&&(b=101,h(p,g))})}).catch(console.log)},t.skip=(s,o)=>{t.dInvoker(s);const u=n.voiceConnections.find(h=>h.channel.guild.id==s.guild.id);if(null===u)return s.channel.send(t.note('fail','No music being played.'));const r=t.getQueue(s.guild.id);if(!t.canSkip(s.member,r.songs))return s.channel.send(t.note('fail',`You cannot skip this as you didn't queue it.`)).then(h=>{h.delete(5e3)});let c=t.queues.get(s.guild.id);'none'!==c.loop&&('none'==c.loop,t.queues.set(s.guild.server,c));let f=1;!isNaN(o)&&0<parseInt(o)&&(f=parseInt(o)),f=Math.min(f,r.songs.length),r.songs.splice(0,f-1);try{const h=u.player.dispatcher;if((!h||null===h)&&t.logging)return console.log(new Error(`dispatcher null on skip cmd [${s.guild.name}] [${s.author.username}]`));u.paused&&h.resume(),h.end()}catch(h){t.logging&&console.log(new Error(`Skip command dispatcher error from userID ${s.author.id} in guildID ${s.guild.id}\n${h.stack}`));const g=h.toString().split(':');return s.channel.send(t.note('fail',`Error occoured!\n\`\`\`\n${g[0]}: ${g[1]}\n\`\`\``))}return t.queues.has(s.guild.id)&&'none'!==t.queues.get(s.guild.id).loop?s.channel.send(t.note('note','Skipped **'+f+'**! (Disabled Looping)')):s.channel.send(t.note('note','Skipped **'+f+'**!'))},t.queue=(s,o)=>{t.dInvoker(s);const u=t.getQueue(s.guild.id,!0);t.isQueueEmpty(t.queues.get(s.guild.id)).then(f=>{if(!0==f)return s.channel.send(t.note('note','Queue empty.'))}).catch(f=>{if(f)return console.log(`[isQueueEmpty] [queueCmd] [${s.guild.name}]: ${new Error(f)}`),s.channel.send(t.note('fail','Error occoured!'))});let r;if(s.channel.permissionsFor(s.guild.me).has('EMBED_LINKS')){const f=o?parseInt(o)-1:null;let h=u.length;if(!o){const g=new Discord.RichEmbed;if(25<u.length&&(h=25),t.enableQueueStat){let p='Stopped';const b=n.voiceConnections.find(v=>v.channel.guild.id==s.guild.id);if(null!==b){const v=b.player.dispatcher;p=v.paused?'Paused':'Playing',g.setAuthor(`Song Queue (${p})`,n.user.avatarURL)}else g.setAuthor(`Song Queue`,n.user.avatarURL)}try{for(var c=0;c<h;c++)u[c]!==u.last&&u[c]!==u.loop&&g.addField(`${u[c].channelTitle}`,`[${u[c].title}](${u[c].url})`,t.inlineEmbeds);g.setColor(t.embedColor),g.setFooter(`Total songs: ${u.length}`,s.author.displayAvatarURL)}catch(p){console.log(p.stack)}setTimeout(()=>{s.channel.send({embed:g})},1500)}else if(s.channel.permissionsFor(s.guild.me).has('EMBED_LINKS')){if(f>u.length)return s.channel.send(t.note('fail','Not a valid song number.'));const g=new Discord.RichEmbed,p=n.users.get(u[f].requester);g.setAuthor(`Queued Song #${o}`,n.user.avatarURL),g.addField(u[f].channelTitle,`[${u[f].title}](${u[f].url})`,t.inlineEmbeds),g.addField(`Queued On`,u[f].queuedOn,t.inlineEmbeds),g.setThumbnail(u[f].thumbnails[t.thumbnailType].url),g.setColor(t.embedColor),t.requesterName&&p&&g.setFooter(`Queued by: ${p.username}`,u[f].requesterAvatarURL),t.requesterName&&!p&&g.setFooter(`Queued by: \`UnknownUser (id: ${u[f].requester})\``,u[f].requesterAvatarURL),s.channel.send({embed:g})}else;}else try{r=t.requesterName?u.map((f,h)=>h+1+': '+f.title+' | Requested by '+n.users.get(f.requester).username).join('\n'):u.map((f,h)=>h+1+': '+f.title).join('\n')}catch(f){t.logging&&console.log(`[${s.guild.name}] [queueCmd] `+f.stack);const h=f.toString().split(':');return s.channel.send(t.note('fail',`Error occoured!\n\`\`\`\n${h[0]}: ${h[1]}\n\`\`\``))}finally{if(1900<r.length){const f=r.substr(0,1899),h=r.substr(1900,r.length);if(1900<h.length){let g='Stopped';const p=n.voiceConnections.find(b=>b.channel.guild.id==s.guild.id);if(null!==p){const b=p.player.dispatcher;g=b.paused?'Paused':'Playing'}s.channel.send(t.note('wrap','Queue ('+g+'):\nPast character limit...'))}else if(t.enableQueueStat){let g='Stopped';const p=n.voiceConnections.find(b=>b.channel.guild.id==s.guild.id);if(null!==p){const b=p.player.dispatcher;g=b.paused?'Paused':'Playing'}s.channel.send(t.note('wrap','Queue ('+g+'):\n'+f)),s.channel.send(t.note('wrap','Queue (2) ('+g+'):\n'+h))}else s.channel.send(t.note('wrap','Queue:\n'+f)),s.channel.send(t.note('wrap','Queue (2):\n'+h))}else if(t.enableQueueStat){let f='Stopped';const h=n.voiceConnections.find(g=>g.channel.guild.id==s.guild.id);if(null!==h){const g=h.player.dispatcher;f=g.paused?'Paused':'Playing'}s.channel.send(t.note('wrap','Queue ('+f+'):\n'+r))}else s.channel.send(t.note('wrap','Queue:\n'+r))}},t.np=s=>{t.dInvoker(s);const u=n.voiceConnections.find(h=>h.channel.guild.id==s.guild.id),r=t.getQueue(s.guild.id,!0);if(null===u&&0<r.length)return s.channel.send(t.note('fail','No music is being played, but an ongoing queue is avainable.'));if(null===u)return s.channel.send(t.note('fail','No music is being played.'));u.player.dispatcher;if(t.isQueueEmpty(t.queues.get(s.guild.id)).then(h=>{if(!0==h)return s.channel.send(t.note('note','Queue empty.'))}).catch(h=>{if(h)return console.log(`[isQueueEmpty] [np] [${s.guild.name}]: ${new Error(h)}`),s.channel.send(t.note('fail','Error occoured!'))}),s.channel.permissionsFor(s.guild.me).has('EMBED_LINKS')){const h=new Discord.RichEmbed;try{h.setAuthor('Now Playing',n.user.avatarURL);var f=r[0].title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');h.setColor(t.embedColor),h.addField(r[0].channelTitle,`[${f}](${r[0].url})`,t.inlineEmbeds),h.addField('Queued On',r[0].queuedOn,t.inlineEmbeds),h.setThumbnail(r[0].thumbnails.high.url);const g=n.users.get(r[0].requester);t.requesterName&&g&&h.setFooter(`Requested by ${n.users.get(r[0].requester).username}`,r[0].requesterAvatarURL),t.requesterName&&!g&&h.setFooter(`Requested by \`UnknownUser (ID: ${r[0].requester})\``,r[0].requesterAvatarURL),s.channel.send({embed:h})}catch(g){console.error(`[${s.guild.name}] [npCmd] `+g.stack)}}else try{var f=r[0].title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');s.channel.send(`Now Playing: **${f}**\nRequested By: ${n.users.get(r[0].requester).username}\nQueued On: ${r[0].queuedOn}`)}catch(h){console.error(`[${s.guild.name}] [npCmd] `+h.stack)}},t.pause=s=>{t.dInvoker(s);const u=n.voiceConnections.find(c=>c.channel.guild.id==s.guild.id);if(null===u)return s.channel.send(t.note('fail','No music being played.'));if(!t.isAdmin(s.member)&&!t.anyoneCanPause)return s.channel.send(t.note('fail','Only Admins are allowed to use this command.'));const r=u.player.dispatcher;return r.paused?s.channel.send(t.note(`fail`,`Music already paused!`)):void(s.channel.send(t.note('note','Playback paused.')),!r.paused&&r.pause())},t.leave=s=>{if(t.dInvoker(s),t.isAdmin(s.member)||!0===t.anyoneCanLeave){const u=n.voiceConnections.find(r=>r.channel.guild.id==s.guild.id);if(null===u)return s.channel.send(t.note('fail','I\'m not in a voice channel.'));if(t.clearOnLeave&&t.emptyQueue(s.guild.id),!u.player.dispatcher)return;u.player.dispatcher.end(),u.disconnect(),s.channel.send(t.note('note','Successfully left your voice channel!')),setTimeout(()=>{let r=n.voiceConnections.find(c=>c.channel.guild.id==s.guild.id);if(r.player.dispatcher)try{r.player.dispatcher.end(),r.disconnect()}catch(c){console.error(`[leaevCmd] [${s.guild.name}] ${c.stack}`)}},2500)}else{const u=Math.floor(100*Math.random()+1);return 10>=u?s.channel.send(t.note('fail',`I'm afraid I can't let you do that, ${s.author.username}.`)):s.channel.send(t.note('fail','Sorry, you\'re not allowed to do that.'))}},t.join=s=>{if(t.dInvoker(s),!(t.isAdmin(s.member)||!0===t.anyoneCanJoin)){const u=Math.floor(100*Math.random()+1);return 10>=u?s.channel.send(t.note('fail',`I'm afraid I can't let you do that, ${s.author.username}.`)):s.channel.send(t.note('fail','Sorry, you\'re not allowed to do that.'))}if(s.member.voiceChannel&&s.member.voiceChannel.joinable)s.member.voiceChannel.join().then(()=>{s.channel.send(t.note('note','Joined your voice channel. :ok_hand:'))}).catch(u=>{console.error(u),s.channel.send(t.note('fail','Error occoured!'))});else{if(!s.member.voiceChannel)return s.channel.send(t.note('fail','Doesn\'t seem you\'re in a voice channel.'));if(s.member.voiceChannel&&!s.member.voiceChannel.joinable)return s.channel.send(t.note('fail','Can\'t join your voice channel.'))}},t.clearqueue=s=>{return t.dInvoker(s),t.queues.has(s.guild.id)?void(t.isAdmin(s.member)?t.emptyQueue(s.guild.id).then(()=>{const u=n.voiceConnections.find(r=>r.channel.guild.id==s.guild.id);null!==u&&(u.player.dispatcher.end(),u.disconnect()),s.channel.send(t.note('note','Queue cleared.'))}).catch(u=>{console.log(new Error(`[clearQueue] [${s.guild.name}] ${u}`))}):s.channel.send(t.note('fail',`I'm sorry, but you cannot do this.`))):s.channel.send(t.note('fail','No server queue.'))},t.resume=s=>{t.dInvoker(s);const u=n.voiceConnections.find(c=>c.channel.guild.id==s.guild.id);if(null===u)return s.channel.send(t.note('fail','No music is being played.'));if(!t.isAdmin(s.member)&&!t.anyoneCanPause)return s.channel.send(t.note('fail',`I'm sorry, but you cannot do this.`));s.channel.send(t.note('note','Playback resumed.'));const r=u.player.dispatcher;r.paused&&r.resume()},t.volume=(s,o)=>{t.dInvoker(s);const u=n.voiceConnections.find(f=>f.channel.guild.id==s.guild.id);if(null===u)return s.channel.send(t.note('fail','No music is being played.'));if(!o)return s.channel.send(t.note('fail','No volume specified.'));o=parseInt(o);const r=t.getQueue(s.guild.id,!0);if(!t.canAdjust(s.member,r))return s.channel.send(t.note('fail',`I'm sorry, but you cannot do that.`));const c=u.player.dispatcher;return 200<o||0>=o?s.channel.send(t.note('fail','Volume out of range, must be within 1 - 200')):void(c.setVolume(o/100),s.channel.send(t.note('note','Volume set to '+o)))},t.loop=s=>{if(t.dInvoker(s),!t.queues.has(s.guild.id))return s.channel.send(t.note('fail',`No queue for this server found!`));var u=t.queues.get(s.guild.id);return'none'!=u.loop&&u.loop?'single'==u.loop?(u.loop='queue',t.queues.set(s.guild.id,u),s.channel.send(t.note('note','Looping queue enabled! :repeat:'))):'queue'==u.loop?('none'==u.loop,t.queues.set(s.guild.id,u),s.channel.send(t.note('note','Looping disabled! :arrow_forward:'))):void 0:(u.loop='single',t.queues.set(s.guild.id,u),s.channel.send(t.note('note','Looping single enabled! :repeat_one:')))},t.set=(s,o,u)=>{if(!t.isAdmin(s.member))return s.channel.send(t.note('fail',`Only admins may do this!`));const r=['prefix'];if(!u[0])return s.channel.send(t.note('note',`Valid settings are: ${r.join(', ')}.`));if(!r.includes(u[0]))return s.channel.send(t.note('fail','Not a valid setting!'));if(u[0]&&'prefix'==u[0]){const c=u.slice(1,u.length).join(' ');if(!c||1>c.legnth)return s.channel.send(t.note('fail','Please specify a prefix!'));t.updatePrefix(s.guild.id,c).then(f=>{f&&s.channel.send(t.note('note',f))}).catch(f=>{if(f)return s.channel.send(t.note('fail',`Error!\n${f}`)),console.log(`[updatePrefix] [${s.guild.id}] ${f}`)})}},t.executeQueue=(s,o)=>{if(0>=o.songs.length){const u=n.voiceConnections.find(r=>r.channel.guild.id==s.guild.id);if(null===u)return}t.isQueueEmpty(o).then(u=>{if(!0==u){s.channel.send(t.note('note','Playback finished.'));const r=n.voiceConnections.find(c=>c.channel.guild.id==s.guild.id);if(null!==r)return r.disconnect()}}).catch(u=>{if(u){console.error(`[executeQueue]: ${new Error(u)}`),s.channel.send(t.note('fail','Error occoured on starting the queue!'));const r=n.voiceConnections.find(c=>c.channel.guild.id==s.guild.id);if(null!==r)return r.disconnect()}}),new Promise((u,r)=>{const c=n.voiceConnections.find(f=>f.channel.guild.id==s.guild.id);null===c?s.member.voiceChannel&&s.member.voiceChannel.joinable?s.member.voiceChannel.join().then(f=>{u(f)}).catch(f=>{console.log(f)}):s.member.voiceChannel.joinable?t.emptyQueue(s.guild.id).then(()=>{r()}):(s.channel.send(t.note('fail','I do not have permission to join your voice channel!')),r()):u(c)}).then(u=>{const r=o.songs[0];try{t.getLast(s.guild.id).then(f=>{t.setLast(s.guild.id,r).then(()=>{const p=t.queues.get(s.guild.id);f!==r&&'none'==p.loop&&t.np(s)}).catch(g=>{return s.channel.send(t.note('fail','Error occoured, try again!')),console.error(new Error('Dispatcher SetLast: '+g))})}).catch(f=>{if(f)return s.channel.send(t.note('fail','Error occoured, try again!')),console.error(new Error('Dispatcher GetLast: '+f))});let c=u.playStream(ytdl(r.url,{filter:'audioonly'}),{volume:t.defVolume/100});u.on('error',f=>{console.log(`Dispatcher/connection: ${f}`),s&&s.channel&&s.channel.send(t.note('fail',`Dispatcher error!\n\`${f}\``)),o.songs.shift(),t.executeQueue(s,o)}),c.on('error',f=>{console.log(`Dispatcher: ${f.stack}`),s&&s.channel&&s.channel.send(t.note('fail',`Dispatcher error!\n\`${f}\``)),o.songs.shift(),t.executeQueue(s,o)}),c.on('end',()=>{setTimeout(()=>{let f=t.getQueue(s.guild.id);if('single'==f.loop)t.executeQueue(s,o);else if('queue'==f.loop)o.songs.push(o.songs[0]),o.songs.shift(),t.executeQueue(s,o);else if(0<o.songs.length)o.songs.shift(),t.executeQueue(s,o);else if(0>=o.songs.length){s&&s.channel&&s.channel.send(t.note('note','Playback finished.'));const h=n.voiceConnections.find(g=>g.channel.guild.id==s.guild.id);if(null!==h)return h.disconnect()}},1e3)})}catch(c){console.log(c)}}).catch(u=>{console.log(u)})},t.note=(s,o)=>{if('wrap'===s){let u=o.replace(/`/g,'`'+String.fromCharCode(8203)).replace(/@/g,'@'+String.fromCharCode(8203)).replace(n.token,'REMOVED');return'```\n'+u+'\n```'}return'note'===s?':musical_note: | '+o.replace(/`/g,'`'+String.fromCharCode(8203)):'search'===s?':mag: | '+o.replace(/`/g,'`'+String.fromCharCode(8203)):'fail'===s?':no_entry_sign: | '+o.replace(/`/g,'`'+String.fromCharCode(8203)):'font'===s?o.replace(/`/g,'`'+String.fromCharCode(8203)).replace(/@/g,'@'+String.fromCharCode(8203)).replace(/\\/g,'\\\\').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`'):void console.error(new Error(`${s} was an invalid type`))},exports.note=t.note,exports.addAdmin=s=>{return new Promise((o,u)=>{s&&'string'==typeof s||u('invalid admin object'),t.botAdmins.push(s),o(t.botAdmins)})},exports.getQueue=s=>{if(!s)return console.error(new Error('no server provided for getQueue')),null;let o=t.queues.has(s)?t.queues.get(s):null;return o},exports.setQueue=s=>{return new Promise((o,u)=>{s||u(new Error('no data passed to setQueue')),'string'==typeof s?(s={songs:[],last:null,loop:'none',id:s},t.queues.set(s.id,s),o(t.queues.get(s.id))):'object'==typeof s?((!s.songs||'object'!=typeof s.songs)&&(s.songs=[]),!s.last&&(s.last=null),(!s.loop||'string'!=typeof s.loop)&&(s.loop='none'),(!s.id||'string'!=typeof s.id)&&(s.id=s.toString()),t.queues.set(s.id,s),o(t.queues.get(s.id))):u(new Error('data didn\'t equal a string or object'))})}};
